<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/">
    <title>Optofutureprep - OAT Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        (function initializeExamRuntime() {
            if (window.ExamRuntime) return;
            const registry = {};

            function register(name, factory) {
                if (!name || typeof factory !== "function") {
                    throw new Error("ExamRuntime.register requires a module name and factory.");
                }
                if (registry[name]) {
                    console.warn(`ExamRuntime: module "${name}" already registered. Overwriting.`);
                }
                registry[name] = factory();
            }

            function resolve(name) {
                if (!registry[name]) {
                    throw new Error(`ExamRuntime: module "${name}" has not been loaded.`);
                }
                return registry[name];
            }

            window.ExamRuntime = { register, resolve };
        })();
    </script>
    <script>
        (function loadExamEngineModules() {
            // Skip loading modules via fetch - they will be loaded as script tags instead
            window.examEngineModulesLoading = false;
            window.examEngineModulesReady = true;
            window.dispatchEvent(new Event("examEngineModulesReady"));
        })();
    </script>
    <!-- Global Error Handler -->
    <script>
        // Enhanced error handling to prevent page crashes
        window.addEventListener('error', function (e) {
            console.error('Global error caught:', e.error);
            console.error('Error message:', e.message);
            console.error('Error filename:', e.filename);
            console.error('Error lineno:', e.lineno);
            console.error('Error colno:', e.colno);
            if (e.error && e.error.stack) {
                console.error('Error stack:', e.error.stack);
            }

            // Don't prevent default - let browser handle it, but log it
            // Return true to indicate we handled it (but still let it propagate)
            return false; // Let browser handle errors normally
        }, true);

        window.addEventListener('unhandledrejection', function (e) {
            console.error('Unhandled promise rejection:', e.reason);
            if (e.reason && e.reason.stack) {
                console.error('Promise rejection stack:', e.reason.stack);
            }

            // Prevent unhandled rejection from crashing the page
            e.preventDefault();
        });

        // Check if critical dependencies are loaded
        function checkDependencies() {
            const deps = {
                React: typeof React !== 'undefined',
                ReactDOM: typeof ReactDOM !== 'undefined',
                Babel: typeof Babel !== 'undefined'
            };

            const missing = Object.keys(deps).filter(key => !deps[key]);
            if (missing.length > 0) {
                console.warn('⚠️ Missing dependencies:', missing);
                return false;
            }
            return true;
        }

        // Wait for critical dependencies before proceeding
        let dependencyCheckInterval = setInterval(function () {
            if (checkDependencies()) {
                clearInterval(dependencyCheckInterval);
                console.log('✅ All critical dependencies loaded');
            }
        }, 100);

        // Clear interval after 10 seconds to avoid infinite checking
        setTimeout(function () {
            clearInterval(dependencyCheckInterval);
        }, 10000);
    </script>
    <!-- InstantDB Configuration -->
    <script>
        // InstantDB App ID
        window.INSTANTDB_APP_ID = '18a93a08-3f4f-4e5d-b92a-9663650d0961';

        // Initialize auth state
        window.APP_AUTH_STATE = {
            mode: null, // 'authenticated' or 'anonymous'
            user: null,
            isAuthenticated: false
        };
    </script>
    <style>
        :root {
            --bg: #ffffff;
            --sidebar-bg: #000000;
            --panel-bg: #ffffff;
            --card-bg: #ffffff;
            --card-border: rgba(15, 23, 42, 0.08);
            --text: #1f2937;
            --muted: #9ca3af;
            --header-color: #0e5c84;
            --subject-bg-color: #0e5c84;
            --dashboard-offset: 256px;
            --subject-accent: #0e5c84;
            --subject-accent-dark: #0b4766;
            --subject-accent-light: rgba(14, 92, 132, 0.18);
            --subject-contrast: #ffffff;
            --button-top: #396f96;
            --button-bottom: #1d4e72;
            --button-border: rgba(255, 255, 255, 0.35);
        }

        html,
        body {
            min-height: 100vh;
            color: var(--text);
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #13547a;
        }

        /* Dashboard view background - set via class */
        body.dashboard-active {
            background: #282a5c;
        }

        body.dashboard-active #main-content {
            background: transparent !important;
        }

        /* Dark mode - override body background when dark mode is active */
        body.dark-mode:not(.dashboard-active) {
            background: #111827 !important;
        }

        /* Force black/white background on content areas based on theme */
        .content-area,
        .main-content,
        .card,
        .panel,
        .section {
            background-color: var(--bg) !important;
        }

        /* Ensure text colors follow the theme */
        .content-area *,
        .main-content *,
        .card *,
        .panel *,
        .section * {
            color: var(--text);
        }

        .dashboard-hero {
            position: relative;
        }

        /* Full-width background banner - spans entire viewport */
        .dashboard-hero::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-color: #282a5c;
            background-image: var(--hero-pattern, none);
            background-size: 40px 40px;
            background-repeat: repeat;
            background-position: center top;
            pointer-events: none;
            z-index: -1;
        }

        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(148, 163, 184, 0.35);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(71, 85, 105, 0.75);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(51, 65, 85, 0.85);
        }

        /* Sidebar styles - overlay instead of taking flex space */
        #sidebar {
            background: #000000 !important;
            transition: background-color 0.3s ease;
            position: fixed !important;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 30;
        }

        #sidebar.sidebar-collapsed {
            width: 80px !important;
        }

        #sidebar.sidebar-collapsed .sidebar-nav-text,
        #sidebar.sidebar-collapsed .sidebar-section-header {
            display: none !important;
        }

        #sidebar.sidebar-collapsed #sidebar-brand-container {
            display: none !important;
        }

        #sidebar.sidebar-collapsed #sidebar-eye-icon {
            display: block !important;
        }

        #sidebar:not(.sidebar-collapsed) #sidebar-eye-icon {
            display: none !important;
        }

        #sidebar.sidebar-collapsed #sidebar-toggle i[data-lucide="chevron-left"] {
            transform: rotate(180deg) !important;
        }

        #sidebar #sidebar-header {
            position: relative;
        }

        #sidebar.sidebar-collapsed #sidebar-header {
            justify-content: center !important;
            padding-left: 1.25rem !important;
            padding-right: 1.25rem !important;
        }

        #sidebar.sidebar-collapsed #sidebar-toggle {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
        }

        #sidebar.sidebar-collapsed .sidebar-nav-item {
            justify-content: center !important;
            padding-left: 0.75rem !important;
            padding-right: 0.75rem !important;
        }

        #sidebar.sidebar-collapsed .sidebar-nav-item .flex.items-center.space-x-3 {
            justify-content: center !important;
        }

        #sidebar.sidebar-collapsed .sidebar-submenu {
            display: none !important;
        }

        #sidebar.sidebar-collapsed #sidebar-toggle::after {
            content: '';
            display: block;
            width: 24px;
            height: 24px;
        }

        /* Sidebar navigation item styles */
        .sidebar-nav-item {
            cursor: pointer;
            text-decoration: none;
        }

        .sidebar-nav-item:hover {
            background-color: rgba(255, 255, 255, 0.08) !important;
        }

        .sidebar-nav-item.active {
            color: #ffffff !important;
        }

        .sidebar-nav-item.active i {
            color: #ffffff !important;
        }

        /* Subject-specific active colors - sidebar stays black, only items change */
        #nav-biology.active {
            background-color: #4f72c2 !important;
        }

        #nav-biology.active i {
            color: #ffffff !important;
        }

        #nav-general-chemistry.active {
            background-color: #06B6D4 !important;
        }

        #nav-general-chemistry.active i {
            color: #ffffff !important;
        }

        #nav-organic-chemistry.active {
            background-color: #EA580C !important;
        }

        #nav-organic-chemistry.active i {
            color: #ffffff !important;
        }

        #nav-reading-comprehension.active {
            background-color: #065F46 !important;
        }

        #nav-reading-comprehension.active i {
            color: #ffffff !important;
        }

        #nav-physics.active {
            background-color: #7E22CE !important;
        }

        #nav-physics.active i {
            color: #ffffff !important;
        }

        #nav-quantitative-reasoning.active {
            background-color: #B91C1C !important;
        }

        #nav-quantitative-reasoning.active i {
            color: #ffffff !important;
        }

        /* Home and other nav items use gray when active */
        #nav-home.active {
            background-color: rgba(17, 24, 39, 1) !important;
        }

        #nav-home.active i {
            color: #60A5FA !important;
        }

        #nav-previous-tests.active {
            background-color: rgba(17, 24, 39, 1) !important;
        }

        #nav-previous-tests.active i {
            color: #60A5FA !important;
        }

        /* Sidebar submenu */
        .sidebar-submenu {
            transition: all 0.3s ease;
        }

        .sidebar-submenu.hidden {
            display: none !important;
        }

        /* Subjects chevron rotation - starts at 180deg (down/open), rotates to 0deg (up/closed) */
        #subjects-chevron {
            transition: transform 0.3s ease;
        }

        #subjects-chevron.rotated {
            transform: rotate(0deg) !important;
        }

        #subjects-chevron:not(.rotated) {
            transform: rotate(180deg) !important;
        }

        /* Active tab style */
        .tab-link.active {
            color: #374151;
            /* gray-700 */
            font-weight: 600;
        }

        /* OLD BUTTON STYLES REMOVED - All buttons now use the Clearcoat Button System */
        /* See styles.css for .clearcoat-button-default and .clearcoat-button */

        /* Highlight styles for React-based highlighting */
        .highlighted,
        mark.highlighted,
        .text-highlight.highlight-yellow {
            background-color: #ffff66 !important;
            color: inherit;
            padding: 0 2px;
            display: inline;
            cursor: pointer;
        }

        .highlighted:hover,
        mark.highlighted:hover {
            background-color: #ffeb3b !important;
        }

        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            /* slate-300 */
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 0;
            bottom: 0;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #22c55e;
            /* green-500 */
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        /* Choice selected style */
        .choice-item.selected {
            background-color: #dbeafe;
            /* blue-100 */
            border-color: #3b82f6;
            /* blue-500 */
        }

        /* Result styles */
        .result-correct {
            border-left: 4px solid #22c55e;
            /* green-500 */
        }

        .result-incorrect {
            border-left: 4px solid #ef4444;
            /* red-500 */
        }

        /* Fixed bottom bar used on pre-test/test/review pages to mimic Bootcamp layout */
        .fixed-bottom-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 60;
            background-image: linear-gradient(to bottom, #0e5c84, #0b4766);
            box-shadow: 0 -2px 8px rgba(15, 23, 42, 0.18);
            color: #ffffff;
        }

        /* When Exhibit/Calculator is present for certain subjects, keep NEXT visually centered */
        .fixed-bottom-bar.has-exhibit-button .next-button-container {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
        }

        .exam-header {
            background-color: #0e5c84;
            color: #ffffff;
            box-shadow: 0 2px 4px rgba(15, 23, 42, 0.25);
        }

        /* Custom blue text for tagline - highest specificity */
        #dashboard-react-root .tagline-blue,
        #dashboard-react-root .tagline-blue *,
        .tagline-blue,
        .tagline-blue * {
            color: #60A5FA !important;
        }

        /* Test view specific styles - enforce white background */
        #test-view,
        #pre-test-instructions-view,
        #review-view {
            background: #ffffff;
        }

        /* Test view always uses white background - dark mode disabled for test taking */
        body.test-review-dark-mode #test-view,
        body.dark-mode #test-view {
            background: #ffffff !important;
        }

        /* Review views - allow dark mode for content, but sidebar stays black */
        body.test-review-dark-mode #review-view,
        body.test-review-dark-mode #detailed-review-view,
        body.dark-mode #review-view,
        body.dark-mode #detailed-review-view {
            background: #111827 !important;
        }

        /* Review content - dark mode enabled */
        body.test-review-dark-mode #test-content-wrapper,
        body.test-review-dark-mode .review-content,
        body.test-review-dark-mode .review-explanation-card,
        body.test-review-dark-mode #review-grid-container,
        body.dark-mode #test-content-wrapper,
        body.dark-mode .review-content {
            background: #111827 !important;
            color: #f9fafb !important;
            border-color: #374151 !important;
        }

        body.test-review-dark-mode #test-passage-container,
        body.test-review-dark-mode #test-passage-text,
        body.dark-mode #test-passage-container,
        body.dark-mode #test-passage-text {
            background: #1f2937 !important;
            color: #f9fafb !important;
            border-color: #374151 !important;
        }

        body.test-review-dark-mode #test-passage-container>div:first-child,
        body.dark-mode #test-passage-container>div:first-child {
            background: #111827 !important;
            border-color: #374151 !important;
        }

        body.test-review-dark-mode #test-q-stem,
        body.test-review-dark-mode .review-question-title,
        body.test-review-dark-mode .review-explanation-card,
        body.test-review-dark-mode #review-explanation,
        body.dark-mode #test-q-stem,
        body.dark-mode .review-question-title {
            color: #f9fafb !important;
        }

        body.test-review-dark-mode .choice-label,
        body.test-review-dark-mode .review-choice-item,
        body.dark-mode .choice-label {
            color: #f9fafb !important;
        }

        body.test-review-dark-mode .choice-label:hover,
        body.dark-mode .choice-label:hover {
            background: #374151 !important;
        }

        /* Review choice items in detailed review */
        body.test-review-dark-mode .review-choice,
        body.dark-mode .review-choice {
            background: #1f2937 !important;
            border-color: #374151 !important;
            color: #f9fafb !important;
        }

        body.test-review-dark-mode .review-choice label,
        body.dark-mode .review-choice label {
            color: #f9fafb !important;
        }

        body.test-review-dark-mode .review-choice.correct,
        body.dark-mode .review-choice.correct {
            background: #064e3b !important;
            border-color: #10b981 !important;
        }

        body.test-review-dark-mode .review-choice.incorrect,
        body.dark-mode .review-choice.incorrect {
            background: #7f1d1d !important;
            border-color: #ef4444 !important;
        }

        /* Detailed review view content area */
        body.test-review-dark-mode #detailed-review-view .review-content,
        body.dark-mode #detailed-review-view .review-content {
            background: #111827 !important;
            color: #f9fafb !important;
        }

        body.test-review-dark-mode #detailed-review-view .review-explanation-card,
        body.dark-mode #detailed-review-view .review-explanation-card {
            background: #1f2937 !important;
            border-color: #374151 !important;
            color: #f9fafb !important;
        }

        body.test-review-dark-mode #detailed-review-view #review-explanation,
        body.dark-mode #detailed-review-view #review-explanation {
            color: #f9fafb !important;
        }

        body.test-review-dark-mode .review-explanation-card h3,
        body.dark-mode .review-explanation-card h3 {
            color: #f9fafb !important;
        }

        body.test-review-dark-mode .review-explanation-card p,
        body.dark-mode .review-explanation-card p {
            color: #d1d5db !important;
        }

        /* Review sidebar - ALWAYS black, never changes with dark mode */
        body.test-review-dark-mode .review-sidebar,
        body.dark-mode .review-sidebar {
            background: #000000 !important;
            border-color: rgba(255, 255, 255, 0.08) !important;
        }

        body.test-review-dark-mode .review-sidebar-header,
        body.test-review-dark-mode .review-sidebar-filters,
        body.test-review-dark-mode .review-question-list,
        body.dark-mode .review-sidebar-header,
        body.dark-mode .review-sidebar-filters {
            background: #000000 !important;
        }

        body.test-review-dark-mode .review-filter-btn,
        body.dark-mode .review-filter-btn {
            background: rgba(255, 255, 255, 0.12) !important;
            color: #f8faff !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        body.test-review-dark-mode .review-filter-btn.active,
        body.dark-mode .review-filter-btn.active {
            background: rgba(255, 255, 255, 0.16) !important;
            color: #f8faff !important;
        }

        body.test-review-dark-mode .review-question-item,
        body.dark-mode .review-question-item {
            background: rgba(255, 255, 255, 0.08) !important;
            color: #f8faff !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }

        body.test-review-dark-mode .review-question-item:hover,
        body.dark-mode .review-question-item:hover {
            background: rgba(255, 255, 255, 0.12) !important;
        }

        body.test-review-dark-mode .review-question-item.active,
        body.dark-mode .review-question-item.active {
            background: rgba(255, 255, 255, 0.16) !important;
        }

        body.test-review-dark-mode .review-meta-chip,
        body.dark-mode .review-meta-chip {
            background: #374151 !important;
            color: #f9fafb !important;
        }

        body.test-review-dark-mode .review-action-btn,
        body.dark-mode .review-action-btn {
            background: #374151 !important;
            color: #f9fafb !important;
            border-color: #4b5563 !important;
        }

        body.test-review-dark-mode .review-action-btn:hover,
        body.dark-mode .review-action-btn:hover {
            background: #4b5563 !important;
        }

        body.test-review-dark-mode .review-nav-btn,
        body.dark-mode .review-nav-btn {
            background: #374151 !important;
            color: #f9fafb !important;
        }

        body.test-review-dark-mode .review-nav-btn:hover,
        body.dark-mode .review-nav-btn:hover {
            background: #4b5563 !important;
        }

        body.test-review-dark-mode #review-grid-container .review-row,
        body.dark-mode #review-grid-container .review-row {
            background: #1f2937 !important;
            color: #f9fafb !important;
            border-color: #374151 !important;
        }

        body.test-review-dark-mode #review-grid-container .review-row:hover,
        body.dark-mode #review-grid-container .review-row:hover {
            background: #374151 !important;
        }

        /* Dark mode toggle button - hidden in exams */
        .dark-mode-toggle-btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dark-mode-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Hide dark mode toggle in exam views */
        #test-view .dark-mode-toggle-btn,
        #review-view .dark-mode-toggle-btn,
        #genchem-exam-react-root .dark-mode-toggle-btn {
            display: none !important;
        }

        /* Show highlight upload buttons in exam views */
        #test-highlight-upload-btn,
        #review-highlight-upload-btn {
            display: flex !important;
        }

        /* Dark mode for review view - content responds to dark mode, sidebar stays black */
        body.dark-mode #review-view {
            background: #111827 !important;
        }

        body.dark-mode #review-view .flex-1.overflow-auto {
            background: #111827 !important;
        }

        body.dark-mode #review-grid-container {
            background: #111827 !important;
            color: #f9fafb !important;
        }

        body.dark-mode #review-grid-container .review-row {
            background: #1f2937 !important;
            color: #f9fafb !important;
            border-color: #374151 !important;
        }

        body.dark-mode #review-grid-container .review-row:hover {
            background: #374151 !important;
        }

        body.dark-mode #review-view .border {
            border-color: #374151 !important;
        }

        body.dark-mode #review-view .bg-white {
            background: #1f2937 !important;
        }

        body.dark-mode #review-view .fixed-bottom-bar {
            background: #1f2937 !important;
            border-top-color: #374151 !important;
        }

        body.dark-mode #review-grid-container .review-row span,
        body.dark-mode #review-grid-container .review-row div {
            color: #f9fafb !important;
        }

        body.dark-mode #review-grid-container .review-row svg {
            color: #10b981 !important;
        }

        body.dark-mode #review-view .border-b {
            border-color: #374151 !important;
        }

        /* Ensure passage container scrolls with page (not fixed) */
        #test-passage-container {
            position: static !important;
        }

        /* Remove any sticky/fixed positioning from passage header and title */
        #test-passage-container>div:first-child {
            position: static !important;
        }

        #test-passage-title {
            position: static !important;
        }

        #test-passage-text {
            position: static !important;
        }

        /* Subject page background styling */
        .subject-themed-page {
            background: var(--subject-bg-color) !important;
        }

        /* White content container for subject pages */
        .subject-content-container {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            margin: 32px auto;
            max-width: 800px;
            padding: 36px;
        }

        .subject-tests-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 28px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .subject-tests-meta h1 {
            font-size: 28px;
            font-weight: 700;
            color: #0f172a;
            margin: 0;
        }

        .subject-tests-meta span {
            font-size: 14px;
            color: #334155;
        }

        .subject-test-card {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 24px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 24px;
            transition: box-shadow 0.2s ease;
        }

        .subject-test-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .subject-test-index {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #e5e7eb;
            color: #111827;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .subject-test-info {
            flex: 1 1 240px;
            min-width: 200px;
        }

        .subject-test-title {
            font-size: 18px;
            font-weight: 700;
            color: #0f172a;
            margin: 0 0 6px;
        }

        .subject-test-tagged {
            font-size: 13px;
            color: #475569;
        }

        .subject-test-progress {
            flex: 1 1 220px;
            min-width: 220px;
        }

        .subject-test-progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 999px;
            overflow: hidden;
            display: flex;
        }

        .subject-test-progress-correct {
            background: #22c55e;
            height: 100%;
        }

        .subject-test-progress-incorrect {
            background: #ef4444;
            height: 100%;
        }

        .subject-test-progress-text {
            margin-top: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #334155;
        }

        .subject-test-meta {
            flex: 1 1 180px;
            min-width: 200px;
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
        }

        .subject-test-meta-item {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .subject-test-meta-value {
            font-size: 16px;
            font-weight: 700;
            text-transform: none;
            color: #0f172a;
            letter-spacing: normal;
        }

        .subject-test-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .btn-pill {
            padding: 10px 18px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid transparent;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .btn-pill.review {
            background: var(--subject-accent);
            color: var(--subject-contrast);
            box-shadow: 0 12px 20px -12px rgba(15, 23, 42, 0.3);
        }

        .btn-pill.review:hover {
            background: var(--subject-accent-dark);
            transform: translateY(-1px);
        }

        .btn-pill.reset {
            background: var(--subject-accent-light);
            color: var(--subject-accent);
            border-color: var(--subject-accent);
        }

        .btn-pill.reset:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateY(-1px);
        }

        .btn-pill.start {
            background: #ffffff;
            color: var(--subject-accent);
            border-color: var(--subject-accent);
        }

        .btn-pill.start:hover {
            background: var(--subject-accent-light);
        }

        .exam-close-btn {
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.45);
            color: #ffffff;
            transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
        }

        .exam-close-btn:hover {
            background: rgba(255, 255, 255, 0.28);
        }

        .exam-close-btn:focus {
            outline: 2px solid rgba(255, 255, 255, 0.6);
            outline-offset: 2px;
        }

        .review-layout {
            display: flex;
            background: #f6f8fb;
            min-height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }

        .review-sidebar {
            width: 280px;
            background: #000000 !important;
            color: #f8faff;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.08);
        }

        .review-sidebar-header {
            padding: 24px 24px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
        }

        .review-back-btn {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.12);
            color: inherit;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .review-back-btn:hover {
            background: rgba(255, 255, 255, 0.22);
        }

        .review-sidebar-title {
            font-size: 14px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-weight: 600;
            opacity: 0.8;
            margin-top: 16px;
        }

        .review-sidebar-test {
            font-size: 18px;
            font-weight: 700;
            margin-top: 6px;
        }

        .review-sidebar-progress {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 18px;
        }

        .review-pill {
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.12);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .review-pill .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .review-pill.correct .dot {
            background: #4ade80;
        }

        .review-pill.incorrect .dot {
            background: #f97316;
        }

        .review-pill.unanswered .dot {
            background: #facc15;
        }

        .review-sidebar-filters {
            padding: 16px 24px 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .review-filter-btn {
            padding: 6px 12px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: inherit;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease, border 0.2s ease;
        }

        .review-filter-btn:hover,
        .review-filter-btn.active {
            background: rgba(255, 255, 255, 0.16);
            border-color: rgba(255, 255, 255, 0.35);
        }

        .review-sidebar-search {
            padding: 0 24px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .review-sidebar-search input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            background: rgba(255, 255, 255, 0.16);
            color: inherit;
            font-size: 13px;
        }

        .review-sidebar-search input::placeholder {
            color: rgba(248, 250, 255, 0.6);
        }

        .review-question-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px 10px 24px;
        }

        .review-question-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            margin: 0 14px 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.18s ease, transform 0.18s ease;
            color: rgba(248, 250, 255, 0.85);
        }

        .review-question-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(2px);
        }

        .review-question-item.active {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        .review-question-item .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .review-question-item.correct .status-dot {
            background: #4ade80;
        }

        .review-question-item.incorrect .status-dot {
            background: #f97316;
        }

        .review-question-item.unanswered .status-dot {
            background: #facc15;
        }

        .review-question-item .tag-indicator {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            background: rgba(96, 165, 250, 0.18);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #93c5fd;
        }

        .review-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 32px 48px;
            overflow-y: auto;
            background: #f6f8fb;
        }

        .review-content-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 24px;
            margin-bottom: 18px;
        }

        .review-question-index {
            font-size: 14px;
            font-weight: 600;
            color: #6366f1;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 8px;
        }

        .review-question-title {
            font-size: 22px;
            font-weight: 700;
            color: #111827;
            line-height: 1.4;
        }

        .review-header-actions {
            display: flex;
            gap: 10px;
        }

        .review-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            border: 1px solid rgba(99, 102, 241, 0.2);
            background: white;
            color: #3730a3;
            transition: background 0.2s ease, color 0.2s ease, border 0.2s ease;
        }

        .review-action-btn:hover {
            background: #eef2ff;
            border-color: rgba(99, 102, 241, 0.35);
        }

        #review-mark-btn.is-marked {
            background-image: linear-gradient(to bottom, #ef4444, #dc2626) !important;
            background-color: #dc2626 !important;
            border-color: rgba(127, 29, 29, 0.9) !important;
            color: #ffffff !important;
            box-shadow:
                inset 0 1px 0 rgba(255, 255, 255, 0.45),
                0 2px 4px rgba(127, 29, 29, 0.35) !important;
        }

        #review-tag-btn {
            border: 1px solid rgba(96, 165, 250, 0.35);
            background: rgba(96, 165, 250, 0.12);
            color: #1d4ed8;
        }

        #review-tag-btn.is-tagged {
            background: #1d4ed8;
            color: #ffffff;
            border-color: #1d4ed8;
        }

        .review-meta-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            margin-bottom: 24px;
        }

        .review-meta-chip {
            padding: 8px 14px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            background: #eef2ff;
            color: #3730a3;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .review-meta-chip.success {
            background: #dcfce7;
            color: #166534;
        }

        .review-meta-chip.error {
            background: #fee2e2;
            color: #b91c1c;
        }

        .review-meta-chip.neutral {
            background: #fef9c3;
            color: #92400e;
        }

        .review-choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 28px;
        }

        .review-choice {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            border-radius: 14px;
            border: 2px solid #e5e7eb;
            background: #ffffff;
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        .review-choice.correct {
            border-color: #22c55e;
            background: #f0fdf4;
            box-shadow: 0 8px 18px rgba(34, 197, 94, 0.1);
        }

        .review-choice.incorrect {
            border-color: #ef4444;
            background: #fef2f2;
            box-shadow: 0 8px 18px rgba(239, 68, 68, 0.1);
        }

        .review-choice label {
            display: flex;
            align-items: center;
            gap: 14px;
            font-size: 14px;
            color: #1f2937;
            font-weight: 500;
            flex: 1;
            cursor: default;
        }

        .review-choice .choice-letter {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #e0e7ff;
            color: #3730a3;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 13px;
        }

        .review-choice.correct .choice-letter {
            background: #4ade80;
            color: #0f5132;
        }

        .review-choice.incorrect .choice-letter {
            background: #fca5a5;
            color: #7f1d1d;
        }

        .review-choice svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .review-explanation-card {
            background: #ffffff;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            padding: 24px;
            box-shadow: 0 15px 30px -18px rgba(15, 23, 42, 0.35);
        }

        .review-explanation-card h3 {
            font-size: 18px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .review-explanation-card p {
            color: #4b5563;
            line-height: 1.6;
            font-size: 14px;
        }

        .review-navigation {
            margin-top: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }

        .review-nav-btn {
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid #d1d5db;
            background: #ffffff;
            color: #1f2937;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s ease;
        }

        .review-nav-btn:hover:not(:disabled) {
            background: #f1f5f9;
        }

        .review-nav-btn:disabled {
            opacity: 0.45;
            cursor: not-allowed;
        }

        .review-progress-count {
            font-size: 13px;
            font-weight: 600;
            color: #475569;
        }

        .results-modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.55);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 24px;
        }

        .results-modal {
            background: #ffffff;
            border-radius: 24px;
            width: min(720px, 100%);
            padding: 36px 40px;
            box-shadow: 0 35px 60px -20px rgba(15, 23, 42, 0.3);
            position: relative;
        }

        .results-modal h2 {
            font-size: 26px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 20px;
        }

        .results-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.08);
            color: #0f172a;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
        }

        .results-modal-close:hover {
            background: rgba(15, 23, 42, 0.15);
        }

        .results-modal-meta {
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
            margin-top: 18px;
        }

        .results-modal-actions {
            display: flex;
            gap: 16px;
            margin-top: 28px;
            flex-wrap: wrap;
        }

        .results-modal-btn {
            padding: 12px 22px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .results-modal-btn.primary {
            background: var(--subject-accent);
            color: var(--subject-contrast);
            box-shadow: 0 12px 24px -16px rgba(15, 23, 42, 0.3);
        }

        .results-modal-btn.primary:hover {
            transform: translateY(-1px);
            background: var(--subject-accent-dark);
        }

        .results-modal-btn.secondary {
            background: var(--subject-accent-light);
            color: var(--subject-accent);
        }

        .results-attempt-card {
            display: none;
            align-items: center;
            gap: 24px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 18px;
            padding: 20px 24px;
            box-shadow: 0 15px 40px -24px rgba(15, 23, 42, 0.35);
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .results-attempt-index {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: var(--subject-accent-light);
            color: var(--subject-accent);
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            margin-right: 16px;
        }

        .results-attempt-header {
            display: flex;
            align-items: center;
            min-width: 240px;
            flex: 1 1 220px;
        }

        .results-attempt-title {
            font-size: 18px;
            font-weight: 700;
            color: #111827;
            margin: 0;
        }

        .results-tagged-info {
            font-size: 13px;
            color: #6b7280;
            margin-top: 4px;
        }

        .results-progress {
            flex: 1 1 220px;
            min-width: 220px;
        }

        .results-progress-bar {
            width: 100%;
            height: 10px;
            border-radius: 999px;
            display: flex;
            overflow: hidden;
            background: #f1f5f9;
        }

        .results-progress-correct {
            background: #22c55e;
            height: 100%;
            transition: width 0.3s ease;
        }

        .results-progress-incorrect {
            background: #ef4444;
            height: 100%;
            transition: width 0.3s ease;
        }

        .results-progress-text {
            margin-top: 8px;
            font-size: 13px;
            color: #475569;
            font-weight: 600;
        }

        .results-attempt-meta {
            display: flex;
            gap: 18px;
            flex: 1 1 220px;
            min-width: 220px;
            flex-wrap: wrap;
        }

        .results-meta-item {
            font-size: 12px;
            color: #475569;
            display: flex;
            flex-direction: column;
            gap: 4px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .results-meta-value {
            font-size: 16px;
            letter-spacing: normal;
            text-transform: none;
            color: #111827;
            font-weight: 700;
        }

        .results-attempt-actions {
            display: flex;
            gap: 12px;
            flex: 0 0 auto;
        }

        .results-reset-btn,
        .results-review-btn {
            padding: 10px 18px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid transparent;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .results-reset-btn {
            background: var(--subject-accent-light);
            color: var(--subject-accent);
            border-color: var(--subject-accent);
        }

        .results-reset-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
        }

        .results-review-btn {
            background: var(--subject-accent);
            color: var(--subject-contrast);
            box-shadow: 0 10px 20px -12px rgba(15, 23, 42, 0.35);
        }

        .results-review-btn:hover {
            background: var(--subject-accent-dark);
            transform: translateY(-1px);
            box-shadow: 0 14px 24px -12px rgba(15, 23, 42, 0.35);
        }

        .results-app-view {
            background: linear-gradient(180deg, #4c2a85 0%, #2d1a52 100%);
            min-height: 100vh;
        }

        .results-summary-card {
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 25px 60px rgba(15, 23, 42, 0.3);
            padding: 48px;
            position: relative;
            overflow: hidden;
        }

        .results-summary-card::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(120% 140% at 100% 0%, rgba(99, 102, 241, 0.12), transparent 60%);
            pointer-events: none;
        }

        /* Previous tests view */
        .previous-tests-app {
            background: linear-gradient(180deg, #4c2a85 0%, #2d1a52 100%);
            min-height: 100vh;
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 72px 24px 96px;
            color: #f5f7ff;
            overflow-y: auto;
        }

        .previous-tests-container {
            width: 100%;
            max-width: 1100px;
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .previous-tests-breadcrumb {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        .previous-tests-breadcrumb button {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            background: rgba(255, 255, 255, 0.12);
            color: inherit;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.04em;
            cursor: pointer;
        }

        .previous-tests-heading {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .previous-tests-title {
            font-size: 42px;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin: 0;
        }

        .previous-tests-subtitle {
            font-size: 16px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.75);
        }

        .previous-tests-card {
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 30px 80px rgba(16, 24, 64, 0.35);
            overflow: hidden;
            color: #111827;
        }

        .previous-tests-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 28px 32px 20px;
            border-bottom: 1px solid rgba(15, 23, 42, 0.06);
        }

        .previous-tests-card-title {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .previous-tests-card-meta {
            font-size: 13px;
            color: #64748b;
        }

        .previous-tests-table-wrapper {
            overflow-x: auto;
        }

        .previous-tests-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 720px;
        }

        .previous-tests-table thead th {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 700;
            padding: 14px 18px;
            background: #f1f5f9;
            color: #475569;
        }

        .previous-tests-table tbody tr {
            border-bottom: 1px solid rgba(148, 163, 184, 0.25);
            transition: background 0.2s ease, transform 0.2s ease;
        }

        .previous-tests-table tbody tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        .previous-tests-table tbody td {
            padding: 18px;
            font-size: 15px;
            vertical-align: middle;
        }

        .previous-tests-index {
            font-weight: 700;
            color: #0f172a;
        }

        .previous-tests-raw-score {
            font-weight: 700;
            color: #312e81;
        }

        .previous-tests-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid transparent;
            letter-spacing: 0.02em;
        }

        .previous-tests-empty-state {
            padding: 48px 32px 56px;
            text-align: center;
            color: #1e293b;
        }

        .previous-tests-empty-state svg {
            width: 64px;
            height: 64px;
            color: #818cf8;
            margin-bottom: 16px;
        }

        .previous-tests-empty-state h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .previous-tests-empty-state p {
            font-size: 14px;
            color: #475569;
        }

        /* Previous tests dark mode overrides */
        body.dark-mode #previous-tests-view {
            background: #0f172a !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-hero {
            background: linear-gradient(135deg, #1f3a8a 0%, #111c44 100%) !important;
            box-shadow: 0 20px 45px -20px rgba(15, 23, 42, 0.9) !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-card {
            background: #1f2937 !important;
            color: #f1f5f9 !important;
            box-shadow: 0 20px 60px rgba(2, 6, 23, 0.65) !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-card-header {
            border-bottom-color: rgba(148, 163, 184, 0.2) !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-card-title {
            color: #f9fafb !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-card-meta {
            color: #94a3b8 !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-table thead th {
            background: rgba(15, 23, 42, 0.6) !important;
            color: #cbd5f5 !important;
            border-color: rgba(148, 163, 184, 0.15) !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-table tbody tr {
            border-bottom-color: rgba(51, 65, 85, 0.6) !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-table tbody tr:hover {
            background: rgba(79, 114, 194, 0.08) !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-table tbody td {
            color: #e2e8f0 !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-empty-state {
            color: #e2e8f0 !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-empty-state p {
            color: #94a3b8 !important;
        }

        body.dark-mode #previous-tests-view .previous-tests-empty-state svg {
            color: #a5b4fc !important;
        }

        .score-ring {
            --score-deg: 0deg;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: conic-gradient(#3b82f6 var(--score-deg), #e5e7eb var(--score-deg));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .score-ring::after {
            content: "";
            position: absolute;
            inset: 28px;
            border-radius: 50%;
            background: #ffffff;
            box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.08);
        }

        .score-ring span {
            position: relative;
            font-size: 48px;
            font-weight: 700;
            color: #1e3a8a;
        }

        .metric-card {
            background: #f9fafb;
            border-radius: 18px;
            padding: 20px 24px;
            box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.15);
        }

        .metric-label {
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .metric-value {
            margin-top: 6px;
            font-size: 20px;
            font-weight: 700;
            color: #0f172a;
        }

        /* Apply extra bottom padding to views that use the fixed bar so content isn't hidden */
        .view-with-bottom {
            padding-bottom: 100px;
            /* space for bottom bar (adjust if bar height changes) */
        }

        /* Sidebar always stays black - never changes color */
        #sidebar {
            background-color: #000000 !important;
            color: #d1d5db;
        }

        #sidebar h3 {
            color: #6b7280;
        }

        #main-content {
            background-color: transparent;
        }

        /* Subject pages view - let React component control background based on dark mode */
        #subject-pages-view {
            background-color: transparent;
        }

        #subject-pages-react-root {
            width: 100%;
            height: 100%;
        }

        /* Main content - let React component control background based on dark mode */
        body:not(.dashboard-active) #main-content {
            background-color: transparent;
        }

        /* Dark mode styles for subject pages - fully dark background */
        body.dark-mode #subject-pages-view {
            background-color: #111827 !important;
        }

        body.dark-mode #main-content {
            background-color: #111827 !important;
        }

        body.dark-mode {
            background-color: #111827 !important;
        }

        /* Ensure no white backgrounds show through in dark mode */
        body.dark-mode #subject-pages-react-root {
            background-color: #111827 !important;
        }

        body.dark-mode #subject-pages-react-root>div {
            background-color: #111827 !important;
        }

        /* Apply theme overrides only to the dashboard (home) view so other sections keep their original colors */
        /* Dashboard view should allow React component to control its own styling */
        #dashboard-view {
            background-color: transparent !important;
            padding: 0 !important;
            margin: 0 !important;
            width: 100% !important;
            min-height: 100vh !important;
        }

        /* Ensure dashboard-react-root takes full width and height */
        #dashboard-react-root {
            width: 100%;
            min-height: 100vh;
            position: relative;
        }

        /* Dashboard root container */
        #dashboard-react-root>div {
            position: relative;
            width: 100%;
            box-sizing: border-box;
        }

        /* Full-width header banner - always spans entire viewport, independent of sidebar */
        #dashboard-react-root>div .dashboard-hero {
            width: 100vw !important;
            left: 0 !important;
            right: 0 !important;
            margin-left: calc(-50vw + 50%) !important;
            margin-right: calc(-50vw + 50%) !important;
            position: relative;
            box-sizing: border-box;
        }

        /* Center dashboard content container - subject box */
        #dashboard-react-root>div>div:last-child {
            width: 100%;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
            box-sizing: border-box;
        }

        /* Ensure subject grid card is centered within its container */
        #dashboard-react-root>div>div:last-child>div {
            margin-left: auto;
            margin-right: auto;
        }

        /* Center subject pages content on viewport */
        #subject-pages-react-root>div {
            position: relative;
            margin-left: calc(-1 * var(--dashboard-offset, 256px) / 2);
            width: calc(100% + var(--dashboard-offset, 256px) / 2);
            box-sizing: border-box;
        }

        /* Center subject pages inner container */
        #subject-pages-react-root>div>div:first-child {
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            padding-left: max(calc(var(--dashboard-offset, 256px) / 2), 1rem);
            padding-right: max(calc(var(--dashboard-offset, 256px) / 2), 1rem);
        }

        /* Center subject pages header - align with content */
        #subject-pages-react-root>div header {
            text-align: center;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
        }

        /* Ensure subject pages content card aligns with header */
        #subject-pages-react-root>div>div:first-child>div {
            margin-left: auto;
            margin-right: auto;
        }

        /* When dashboard is visible, ensure main-content is full width */
        #dashboard-view[style*="block"]~*,
        body:has(#dashboard-view[style*="block"]) #main-content {
            background: transparent !important;
        }
    </style>

    <!-- Load JSX components as scripts for file:// compatibility -->
    <script type="text/babel" src="components/CustomButton.jsx"></script>
    <script type="text/babel" src="components/ExamEngine.jsx"></script>
    <script type="text/babel" src="components/subject-pages-react.jsx"></script>
</head>

<body class="antialiased">

    <div class="flex h-screen" style="font-family: Inter, sans-serif;">
        <!-- Sidebar - Fixed overlay, doesn't take flex space -->
        <aside id="sidebar"
            class="bg-black text-white min-h-screen flex flex-col p-0 shadow-2xl transition-all duration-300"
            style="width: 256px;">
            <!-- Logo and Collapse Button -->
            <div id="sidebar-header" class="flex items-center p-5 mb-4 pt-8 justify-between">
                <div id="sidebar-brand-container" class="flex flex-col items-center mr-4">
                    <div id="sidebar-logo"
                        class="w-auto bg-gray-800 rounded-full px-3 py-2 flex items-center shadow-inner mb-1">
                        <span class="text-xl font-bold tracking-tight text-white whitespace-nowrap">
                            <span class="text-blue-400">Opto</span><span class="text-white">future</span><span
                                class="text-blue-400">prep</span>
                        </span>
                    </div>
                    <span class="text-[10px] font-bold tracking-[0.2em] text-blue-400 uppercase opacity-90"
                        style="text-shadow: 0 0 10px rgba(96, 165, 250, 0.4);">Beta Version</span>
                </div>
                <div id="sidebar-eye-icon" class="p-2 hidden">
                    <i data-lucide="eye" class="w-7 h-7 text-blue-400"></i>
                </div>
                <button id="sidebar-toggle" onclick="toggleSidebar()"
                    class="p-1 rounded-full text-gray-400 hover:text-white hover:bg-gray-800 transition duration-150 flex-shrink-0"
                    aria-label="Collapse Sidebar">
                    <i data-lucide="chevron-left" class="w-6 h-6 transition-transform duration-300"></i>
                </button>
            </div>

            <!-- Navigation Links -->
            <nav class="flex-1 space-y-0 text-sm overflow-y-auto">
                <!-- Home Link -->
                <a href="javascript:void(0)" id="nav-home"
                    onclick="showView('dashboard-view', event, this); return false;"
                    class="sidebar-nav-item active flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 text-white bg-gray-900 rounded-lg shadow-md">
                    <i data-lucide="home" class="w-6 h-6 flex-shrink-0 text-blue-400"></i>
                    <span class="sidebar-nav-text">Home</span>
                </a>

                <!-- STUDY Section -->
                <div id="study-section" class="sidebar-section">
                    <div id="study-header"
                        class="px-5 pt-6 pb-2 text-xs uppercase font-medium tracking-wider text-gray-500 sidebar-section-header">
                        STUDY
                    </div>

                    <!-- Subjects (Collapsible) -->
                    <a href="javascript:void(0)" id="nav-subjects" onclick="toggleSubjectsMenu(event); return false;"
                        class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-xl justify-between text-gray-300 bg-gray-900/40 rounded-lg"
                        aria-expanded="true">
                        <div class="flex items-center space-x-3">
                            <i data-lucide="graduation-cap" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                            <span class="sidebar-nav-text">Subjects</span>
                        </div>
                        <i data-lucide="chevron-down" id="subjects-chevron"
                            class="w-5 h-5 ml-auto transition-transform duration-300 rotate-180 sidebar-nav-text"></i>
                    </a>

                    <!-- Subject Sub-links -->
                    <div id="subjects-list" class="space-y-0 sidebar-submenu" aria-hidden="false">
                        <a href="javascript:void(0)" id="nav-biology"
                            onclick="showSubject('Biology', event); return false;"
                            class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 pl-10 text-gray-300 bg-gray-900/40 rounded-lg">
                            <i data-lucide="dna" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                            <span class="sidebar-nav-text">Biology</span>
                        </a>
                        <a href="javascript:void(0)" id="nav-general-chemistry"
                            onclick="showSubject('General Chemistry', event); return false;"
                            class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 pl-10 text-gray-300 bg-gray-900/40 rounded-lg">
                            <i data-lucide="flask-conical" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                            <span class="sidebar-nav-text">General Chemistry</span>
                        </a>
                        <a href="javascript:void(0)" id="nav-organic-chemistry"
                            onclick="showSubject('Organic Chemistry', event); return false;"
                            class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 pl-10 text-gray-300 bg-gray-900/40 rounded-lg">
                            <i data-lucide="atom" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                            <span class="sidebar-nav-text">Organic Chemistry</span>
                        </a>
                        <a href="javascript:void(0)" id="nav-reading-comprehension"
                            onclick="showSubject('Reading Comprehension', event); return false;"
                            class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 pl-10 text-gray-300 bg-gray-900/40 rounded-lg">
                            <i data-lucide="book-open" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                            <span class="sidebar-nav-text">Reading Comprehension</span>
                        </a>
                        <a href="javascript:void(0)" id="nav-physics"
                            onclick="showSubject('Physics', event); return false;"
                            class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 pl-10 text-gray-300 bg-gray-900/40 rounded-lg">
                            <i data-lucide="rocket" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                            <span class="sidebar-nav-text">Physics</span>
                        </a>
                        <a href="javascript:void(0)" id="nav-quantitative-reasoning"
                            onclick="showSubject('Quantitative Reasoning', event); return false;"
                            class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 pl-10 text-gray-300 bg-gray-900/40 rounded-lg">
                            <i data-lucide="calculator" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                            <span class="sidebar-nav-text">Quantitative Reasoning</span>
                        </a>
                    </div>

                    <!-- Full Length Tests -->
                    <a href="javascript:void(0)" onclick="return false;"
                        class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 text-gray-300 bg-gray-900/40 rounded-lg opacity-60 cursor-not-allowed">
                        <i data-lucide="clipboard-list" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                        <span class="sidebar-nav-text">Full Length Tests</span>
                    </a>
                </div>

                <!-- REVIEW Section -->
                <div id="review-section" class="sidebar-section">
                    <div id="review-header"
                        class="px-5 pt-6 pb-2 text-xs uppercase font-medium tracking-wider text-gray-500 border-t border-gray-800 mt-4 sidebar-section-header">
                        REVIEW
                    </div>

                    <a href="javascript:void(0)" id="nav-previous-tests"
                        onclick="showPreviousTests(event); return false;"
                        class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 text-gray-300 rounded-lg">
                        <i data-lucide="clock" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                        <span class="sidebar-nav-text">Previous Tests</span>
                    </a>
                    <a href="javascript:void(0)" id="nav-tagged-questions"
                        onclick="showTaggedQuestions(event); return false;"
                        class="sidebar-nav-item flex items-center py-4 font-medium transition duration-150 px-3 mx-2 text-lg space-x-3 text-gray-300 rounded-lg">
                        <i data-lucide="tag" class="w-6 h-6 flex-shrink-0 text-gray-500"></i>
                        <span class="sidebar-nav-text">Tagged Questions</span>
                    </a>
                </div>
            </nav>

            <div class="h-8"></div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 overflow-y-auto" style="min-height: 100vh; width: 100%; margin-left: 0;">
            <!-- == DASHBOARD VIEW == -->
            <div id="dashboard-view" class="app-view" style="display: block;">
                <div id="dashboard-react-root"></div>
            </div>

            <!-- == SUBJECT PAGES VIEW (New React Component) == -->
            <div id="subject-pages-view" class="app-view" style="display: none;">
                <div id="subject-pages-react-root"></div>
            </div>

            <!-- Exam Modals React Root -->
            <div id="exam-modals-react-root"></div>

            <!-- GenChem Exam React Root -->
            <div id="genchem-exam-react-root" class="app-view flex-col h-screen w-full view-with-bottom"
                style="display: none;"></div>
        </main>


        <!-- == PRE-TEST INSTRUCTIONS VIEW (Hidden by default) == -->
        <div id="pre-test-instructions-view" class="app-view flex flex-col h-screen w-full view-with-bottom"
            style="display: none;">
            <!-- Pre-Test Header -->
            <div class="exam-header flex items-center justify-between text-white px-4 h-[54px]">
                <button id="pre-test-instructions-close-btn" aria-label="Close"
                    class="exam-close-btn w-8 h-8 rounded-full flex items-center justify-center text-xl leading-none"
                    onclick="showView('subject-pages-view', event)">×</button>
                <div class="text-center leading-tight" style="font-family: Arial, sans-serif;">
                    <div style="font-size: 14px; font-weight: normal;">Optofutureprep | OAT</div>
                    <div id="pre-test-instructions-header-title"
                        style="font-size: 11px; opacity: 0.9; font-weight: normal;">Test Title</div>
                </div>
                <div style="font-size: 11px; opacity: 0.9;">&nbsp;</div>
            </div>

            <!-- Pre-Test Content Area -->
            <div class="flex-1 flex justify-center items-start pt-10 pb-6 overflow-auto bg-white">
                <div class="w-[62%] min-w-[740px] bg-white border border-slate-300 shadow-lg p-8">
                    <!-- Instructions Box -->
                    <div class="border-2 border-black p-8 mb-6 bg-white">
                        <h2 id="pre-test-instructions-title" class="font-semibold text-lg mb-2 text-black"
                            style="font-family: Arial, sans-serif; font-size: 16px;">This is Biology Test #1. Read this
                            before starting:</h2>
                        <ol class="list-decimal ml-6 space-y-1 text-sm text-black"
                            style="font-family: Arial, sans-serif; font-size: 14px;">
                            <li id="pre-test-instructions-instruction-1">You have 30 minutes to finish 46 questions.
                            </li>
                            <li>You can review questions before ending the section.</li>
                            <li>Your score analysis appears after finishing.</li>
                        </ol>
                        <p class="text-sm mt-4 text-black" style="font-family: Arial, sans-serif; font-size: 14px;">
                            Click NEXT to continue.</p>
                    </div>

                    <!-- Test Settings -->
                    <h3 class="font-semibold mb-2 text-black" style="font-family: Arial, sans-serif; font-size: 18px;">
                        Test Settings</h3>
                    <div class="space-y-3">
                        <div class="flex items-center gap-3 bg-slate-100 border rounded p-3">
                            <label class="toggle-switch flex-shrink-0">
                                <input type="checkbox" id="toggle-prometric-delay">
                                <span class="slider"></span>
                            </label>
                            <div class="text-sm" style="font-family: Arial, sans-serif; font-size: 14px;">
                                <span class="font-semibold">Prometric Delay:</span> Adds a ~2 second delay on navigation
                                and review.
                            </div>
                        </div>
                        <div class="flex items-center gap-3 bg-slate-100 border rounded p-3">
                            <label class="toggle-switch flex-shrink-0">
                                <input type="checkbox" id="toggle-time-accommodations">
                                <span class="slider"></span>
                            </label>
                            <div class="text-sm" style="font-family: Arial, sans-serif; font-size: 14px;">
                                <span class="font-semibold">Time Accommodations:</span> Get an additional 1.5x time for
                                students who have special accommodations approved by the ADA. (If you need more time,
                                right-click the test timer during the test to set a custom time limit).
                            </div>
                        </div>
                    </div>

                    <div style="display: none;">
                        <!-- Button Management -->
                        <h3 class="font-semibold mb-3 mt-6 text-black"
                            style="font-family: Arial, sans-serif; font-size: 18px;">Button Management</h3>
                        <p class="text-sm mb-4 text-gray-600" style="font-family: Arial, sans-serif; font-size: 14px;">
                            Customize exam buttons with your own images. Changes apply instantly to all exams.</p>
                        <div id="button-management-container" class="space-y-4">
                            <!-- Buttons will be dynamically generated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pre-Test Bottom Bar - Fixed at bottom -->
            <div class="fixed-bottom-bar flex items-center justify-center h-[64px] px-6">
                <button id="pre-test-next-btn"
                    class="px-10 py-2 text-[13px] font-semibold text-white border border-white/30 shadow-[inset_0_1px_0_rgba(255,255,255,0.4)] rounded-none bg-gradient-to-b from-[#396f96] to-[#1d4e72] active:to-[#153c56]"
                    data-button-height="24">
                    BEGIN
                </button>
            </div>
        </div>

        <!-- == TEST VIEW (Hidden by default) == -->
        <div id="test-view" class="app-view flex-col h-screen w-full view-with-bottom" style="display: none;">
            <!-- Test Header -->
            <div class="exam-header flex items-center justify-between text-white px-6 py-2 h-[46px]">
                <div class="flex items-center gap-3">
                    <button
                        onclick="if(typeof window.showExitTestModalReact === 'function'){window.showExitTestModalReact();}else{showExitTestModal();}"
                        aria-label="Close"
                        class="exam-close-btn w-8 h-8 rounded-full flex items-center justify-center text-xl leading-none">×</button>
                    <div class="text-sm font-semibold">Question <span id="test-q-number">1</span> of <span
                            id="test-q-total">40</span></div>
                    <button id="test-dark-mode-toggle" class="dark-mode-toggle-btn" onclick="toggleTestReviewDarkMode()"
                        aria-label="Toggle Dark Mode" title="Toggle Dark Mode">
                        <i data-lucide="moon" class="w-5 h-5"></i>
                    </button>
                </div>
                <div id="test-header-subtitle" class="text-[11px] opacity-90" style="font-family: Arial, sans-serif;">
                    Reading Comprehension — Sample</div>
                <div class="text-sm">Time remaining: <span id="test-timer">30:00</span></div>
            </div>

            <!-- Test Content Area -->
            <div class="flex-1 flex justify-center items-start pt-8 pb-6 overflow-y-auto bg-white">
                <div id="test-content-wrapper"
                    class="w-[62%] min-w-[740px] bg-white border border-slate-300 shadow-lg p-8 relative">
                    <!-- Stem and choices -->
                    <div class="mb-5" id="test-content-area">
                        <p id="test-q-stem" class="mb-4 leading-relaxed">Question stem...</p>
                        <div id="test-q-choices" class="flex flex-col gap-3 text-sm">
                            <!-- Choices will be dynamically injected here -->
                        </div>
                    </div>

                    <!-- Reading Comprehension Passage (only for Reading Comprehension) -->
                    <div id="test-passage-container"
                        style="display: none; position: static; height: 400px; overflow-y: auto;"
                        class="mt-6 w-full border border-slate-300 rounded-sm bg-white">
                        <!-- Title Bar: Scrolls with passage content (NOT sticky) -->
                        <div class="flex justify-center py-2 bg-gray-50 border-b border-slate-300"
                            style="background-color: #f9fafb; position: static;">
                            <h3 id="test-passage-title" class="font-bold text-base text-gray-900 tracking-wide"
                                style="font-family: Arial, sans-serif; position: static;">Passage 1</h3>
                        </div>
                        <!-- Passage Content: Part of scrollable area -->
                        <div id="test-passage-text" class="p-4 bg-white text-sm leading-relaxed space-y-4"
                            style="user-select: text; font-family: Arial, sans-serif; position: static;">
                            <!-- Passage text will be inserted here -->
                        </div>
                    </div>

                    <p class="mt-6 text-xs text-gray-500">Click NEXT to continue.</p>
                </div>
            </div>

            <!-- Test Bottom Bar -->
            <div class="fixed-bottom-bar flex items-center justify-between h-[50px] px-6">
                <div class="flex gap-2">
                    <button id="test-prev-btn" class="exam-btn px-8 py-1.5">PREVIOUS</button>
                </div>

                <div class="next-button-container flex justify-center flex-1">
                    <button id="test-next-btn" class="exam-btn px-10 py-1.5">NEXT</button>
                </div>

                <div class="flex gap-2 items-center">
                    <button id="test-mark-btn"
                        class="exam-btn px-5 py-1.5 flex items-center justify-center tracking-[0.5px]">MARK</button>
                    <button id="test-exhibit-btn" class="exam-btn px-5 py-1.5" onclick="showExhibit()">EXHIBIT</button>
                    <button id="test-review-btn" class="exam-btn px-5 py-1.5">REVIEW</button>
                </div>
            </div>
        </div>

        <!-- == REVIEW VIEW (Hidden by default) == -->
        <div id="review-view" class="app-view flex-col h-screen w-full view-with-bottom" style="display: none;">
            <!-- Review Header -->
            <div class="exam-header flex items-center justify-between text-white px-4 h-[46px]">
                <div class="flex items-center gap-3">
                    <button aria-label="Close"
                        class="exam-close-btn w-8 h-8 rounded-full flex items-center justify-center text-xl leading-none"
                        onclick="if(typeof window.showExitTestModalReact === 'function'){window.showExitTestModalReact();}else{showExitTestModal();}">×</button>
                    <div style="font-size: 14px; font-weight: normal; font-family: Arial, sans-serif;">Review Questions
                    </div>
                    <button id="review-dark-mode-toggle" class="dark-mode-toggle-btn"
                        onclick="toggleTestReviewDarkMode()" aria-label="Toggle Dark Mode" title="Toggle Dark Mode">
                        <i data-lucide="moon" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="text-center leading-tight" style="font-family: Arial, sans-serif;">
                    <div style="font-size: 14px; font-weight: normal;">Optofutureprep | OAT</div>
                    <div id="review-header-title" style="font-size: 11px; opacity: 0.9; font-weight: normal;">Test Title
                    </div>
                </div>
                <div style="font-size: 14px; font-weight: normal; font-family: Arial, sans-serif; white-space: nowrap;">
                    Timer paused: <span id="review-timer">30:00</span></div>
            </div>

            <!-- Review Content -->
            <div class="flex-1 overflow-auto bg-white">
                <div class="max-w-[980px] mx-auto p-6">
                    <div class="border border-gray-300">
                        <!-- Table Headers -->
                        <div class="grid grid-cols-4 bg-[#5f85a0] text-white"
                            style="font-size: 14px; font-weight: 700; font-family: Arial, sans-serif;">
                            <div class="px-3 py-2 border-r border-[#4f7288]">Name</div>
                            <div class="px-3 py-2 border-r border-[#4f7288]">Marked</div>
                            <div class="px-3 py-2 border-r border-[#4f7288]">Completed</div>
                            <div class="px-3 py-2">Skipped</div>
                        </div>
                        <!-- Table Rows -->
                        <div id="review-grid-container" class="max-h-[calc(100vh-200px)] overflow-auto bg-white">
                            <!-- Review rows will be dynamically injected here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Review Footer -->
            <div class="fixed-bottom-bar flex items-center justify-between h-[50px] px-6">
                <div class="flex gap-2 items-center">
                    <button id="review-marked-btn" class="exam-btn px-5 py-1.5"
                        onclick="jumpToQuestion('marked')">REVIEW MARKED</button>
                    <button id="review-all-btn" class="exam-btn px-5 py-1.5" onclick="jumpToQuestion('all')">REVIEW
                        ALL</button>
                    <button id="review-incomplete-btn" class="exam-btn px-5 py-1.5"
                        onclick="jumpToQuestion('incomplete')">REVIEW INCOMPLETE</button>
                </div>
                <button id="review-end-btn" class="exam-btn px-8 py-1.5"
                    onclick="if(typeof window.showEndTestModalReact === 'function'){window.showEndTestModalReact();}else{openSubmitConfirmation();}">END</button>
            </div>
        </div>

        <!-- == RESULTS VIEW (Score Summary - Hidden by default) == -->
        <div id="results-view" class="app-view results-app-view" style="display: none;">
            <!-- Close button (X) in top-left corner -->
            <button onclick="showView('dashboard-view')"
                class="fixed top-6 left-6 z-50 w-10 h-10 rounded-full bg-gray-800 hover:bg-gray-700 text-white flex items-center justify-center text-2xl font-bold shadow-lg transition-colors"
                aria-label="Back to Home">
                ×
            </button>

            <div class="w-full flex justify-center px-6 pb-24 pt-12">
                <div class="w-full max-w-5xl">
                    <div class="results-summary-card">
                        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6 relative z-[1]">
                            <div>
                                <div id="result-breadcrumb"
                                    class="text-sm font-semibold text-indigo-500 uppercase tracking-wide mb-2">Practice
                                    Test</div>
                                <h1 id="result-test-title" class="text-3xl font-bold text-gray-900">Test Results</h1>
                                <div class="flex flex-wrap items-center gap-3 mt-3 text-sm text-gray-500">
                                    <span id="result-date-chip"
                                        class="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-indigo-50 text-indigo-600 font-medium">Date</span>
                                    <span id="result-question-count"
                                        class="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-slate-100 text-slate-600 font-medium">0
                                        Questions</span>
                                    <span id="result-attempt-chip"
                                        class="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-slate-100 text-slate-600 font-medium">Attempt
                                        1</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <button id="results-reset-btn"
                                    class="px-4 py-2 bg-white/70 border border-indigo-200 text-indigo-600 font-semibold rounded-lg hover:bg-white transition-colors"
                                    onclick="handleResetCurrentTest()">Reset Attempts</button>
                                <button id="results-start-review-btn"
                                    class="px-5 py-2.5 bg-indigo-600 text-white font-semibold rounded-lg shadow hover:bg-indigo-700 transition-colors"
                                    onclick="showDetailedReview()">Start Review</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10 mt-10 relative z-[1]">
                            <div class="flex flex-col items-center justify-center">
                                <div id="result-score-ring" class="score-ring"><span id="result-score-value">200</span>
                                </div>
                                <div id="result-average-score" class="mt-4 text-sm text-gray-500">Average: --</div>
                            </div>
                            <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="metric-card">
                                    <div class="metric-label">Raw Score</div>
                                    <div class="metric-value" id="results-raw-score">--</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Correct / Total</div>
                                    <div class="metric-value" id="results-correct-total">--</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Time Per Question</div>
                                    <div class="metric-value" id="results-time-per-question">--</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Total Time</div>
                                    <div class="metric-value" id="results-total-time">--</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="results-attempt-card" class="results-attempt-card">
                        <div class="results-attempt-header">
                            <div id="results-attempt-index" class="results-attempt-index">1</div>
                            <div>
                                <h3 id="results-attempt-title" class="results-attempt-title">Subject Test #1</h3>
                                <div id="results-tagged-info" class="results-tagged-info">0 of 0 questions tagged</div>
                            </div>
                        </div>

                        <div class="results-progress">
                            <div class="results-progress-bar">
                                <div id="results-progress-correct" class="results-progress-correct" style="width: 0%;">
                                </div>
                                <div id="results-progress-incorrect" class="results-progress-incorrect"
                                    style="width: 0%;"></div>
                            </div>
                            <div id="results-progress-text" class="results-progress-text">0 of 0 correct</div>
                        </div>

                        <div class="results-attempt-meta">
                            <div class="results-meta-item">
                                <span>Date</span>
                                <span id="results-meta-date" class="results-meta-value">--</span>
                            </div>
                            <div class="results-meta-item">
                                <span>Score</span>
                                <span id="results-meta-score" class="results-meta-value">--</span>
                            </div>
                            <div class="results-meta-item">
                                <span>Correct</span>
                                <span id="results-meta-correct" class="results-meta-value">--</span>
                            </div>
                            <div class="results-meta-item">
                                <span>Attempts</span>
                                <span id="results-meta-attempts" class="results-meta-value">--</span>
                            </div>
                        </div>

                        <div class="results-attempt-actions">
                            <button class="results-reset-btn" onclick="handleResetCurrentTest()">Reset</button>
                            <button class="results-review-btn" onclick="showDetailedReview()">Review</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- == PREVIOUS TESTS VIEW (Hidden by default) == -->
        <div id="previous-tests-view" class="app-view previous-tests-app" style="display: none; background: #ffffff;">
            <div class="previous-tests-container" style="padding: 32px 0 64px;">
                <div class="previous-tests-hero"
                    style="position: relative; background: #4f72c2; border-radius: 32px; padding: 32px 36px; color: #ffffff; box-shadow: 0 20px 45px -20px rgba(79, 114, 194, 0.55); text-align: center;">
                    <button id="previous-tests-dark-mode-toggle" class="dark-mode-toggle-btn"
                        onclick="toggleTestReviewDarkMode()" aria-label="Toggle Dark Mode" title="Toggle Dark Mode"
                        style="position: absolute; top: 18px; right: 20px; background: rgba(255,255,255,0.16); border: 1px solid rgba(255,255,255,0.35); color: #ffffff;">
                        <i data-lucide="moon" class="w-5 h-5"></i>
                    </button>
                    <h1
                        style="font-size: 34px; font-weight: 800; margin: 0; display: inline-flex; align-items: center; gap: 10px; justify-content: center;">
                        Previous Tests
                        <span aria-hidden="true">📘</span>
                    </h1>
                    <p style="margin-top: 10px; font-size: 16px; font-weight: 600; opacity: 0.95;">
                        Progress becomes clearer when you trace the path that brought you here. 🔁
                    </p>
                </div>

                <div class="previous-tests-card">
                    <div class="previous-tests-card-header">
                        <h2 class="previous-tests-card-title">Test History</h2>
                        <div id="previous-tests-card-meta" class="previous-tests-card-meta">Most recent attempt shown
                            first</div>
                    </div>

                    <div class="previous-tests-table-wrapper">
                        <table class="previous-tests-table">
                            <thead>
                                <tr>
                                    <th>Test Name</th>
                                    <th>Subject</th>
                                    <th>Estimated Score</th>
                                    <th>Date Taken</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="previous-tests-table-body"></tbody>
                        </table>
                    </div>

                    <div id="previous-tests-empty" class="previous-tests-empty-state" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21 12 17 5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z" />
                        </svg>
                        <h3>No test attempts yet</h3>
                        <p>Complete a practice exam to see it listed here.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- == TAGGED REVIEW VIEW == -->
        <div id="tagged-review-view" class="app-view review-layout" style="display: none;">
            <aside class="review-sidebar">
                <div class="review-sidebar-header">
                    <button class="review-back-btn" onclick="showTaggedQuestions()"
                        aria-label="Back to tagged list">×</button>
                    <div class="review-sidebar-title">Tagged Review</div>
                    <div id="tagged-review-header-title" class="review-sidebar-test">Subject</div>
                    <div class="review-sidebar-progress">
                        <div class="review-pill correct">
                            <span class="dot"></span>
                            <span>Correct</span>
                            <span id="tagged-review-correct-count">0</span>
                        </div>
                        <div class="review-pill incorrect">
                            <span class="dot"></span>
                            <span>Incorrect</span>
                            <span id="tagged-review-incorrect-count">0</span>
                        </div>
                        <div class="review-pill unanswered">
                            <span class="dot"></span>
                            <span>Unanswered</span>
                            <span id="tagged-review-unanswered-count">0</span>
                        </div>
                    </div>
                </div>

                <div class="review-sidebar-filters">
                    <button id="tagged-review-filter-all" class="review-filter-btn active"
                        onclick="filterTaggedReview('all')">All</button>
                    <button id="tagged-review-filter-correct" class="review-filter-btn"
                        onclick="filterTaggedReview('correct')">Correct</button>
                    <button id="tagged-review-filter-incorrect" class="review-filter-btn"
                        onclick="filterTaggedReview('incorrect')">Incorrect</button>
                    <button id="tagged-review-filter-unanswered" class="review-filter-btn"
                        onclick="filterTaggedReview('unanswered')">Unanswered</button>
                </div>

                <div class="review-sidebar-search">
                    <input id="tagged-review-search" type="search" placeholder="Search tagged questions..."
                        oninput="handleTaggedReviewSearch()">
                </div>

                <div id="tagged-review-question-list" class="review-question-list"></div>
            </aside>

            <section class="review-content">
                <div class="review-content-header">
                    <div>
                        <div class="review-question-index">Question <span id="tagged-review-q-number">1</span> of <span
                                id="tagged-review-q-total">0</span></div>
                        <h1 id="tagged-review-q-stem" class="review-question-title">Question text will appear here</h1>
                    </div>
                    <div class="review-header-actions">
                        <button id="tagged-review-remove-btn" class="review-action-btn"
                            onclick="removeTagFromTaggedReview()">Remove Tag</button>
                    </div>
                </div>

                <div class="review-meta-row">
                    <div id="tagged-review-status-chip" class="review-meta-chip success">
                        <span id="tagged-review-status-text">Correct</span>
                    </div>
                    <div id="tagged-review-answer-chip" class="review-meta-chip neutral">
                        <span id="tagged-review-correct-answer">Correct Answer: --</span>
                    </div>
                    <div id="tagged-review-user-chip" class="review-meta-chip">
                        <span id="tagged-review-user-answer">Your Answer: --</span>
                    </div>
                    <div id="tagged-review-meta-source" class="review-meta-chip">
                        <span id="tagged-review-source">Source: --</span>
                    </div>
                </div>

                <div id="tagged-review-choices" class="review-choices"></div>

                <div class="review-explanation-card">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <span>Explanation</span>
                    </h3>
                    <div id="tagged-review-explanation">
                        <p>No explanation available for this tagged question.</p>
                    </div>
                </div>

                <div class="review-navigation">
                    <button class="review-nav-btn" onclick="taggedReviewPrev()">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                        Previous
                    </button>
                    <div id="tagged-review-progress" class="review-progress-count">1 / 0</div>
                    <button class="review-nav-btn" onclick="taggedReviewNext()">
                        Next
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
            </section>
        </div>

        <!-- == DETAILED REVIEW VIEW (Hidden by default) == -->
        <div id="detailed-review-view" class="app-view review-layout" style="display: none;">
            <aside class="review-sidebar">
                <div class="review-sidebar-header">
                    <div class="flex items-center justify-between w-full mb-2">
                        <button class="review-back-btn"
                            onclick="if(currentSubject){showSubject(currentSubject, null);}else{showView('dashboard-view', null, document.getElementById('nav-home'));}"
                            aria-label="Back to subject">×</button>
                        <button id="detailed-review-dark-mode-toggle" class="dark-mode-toggle-btn"
                            onclick="toggleTestReviewDarkMode()" aria-label="Toggle Dark Mode" title="Toggle Dark Mode"
                            style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                            <i data-lucide="moon" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="review-sidebar-title">Test Review</div>
                    <div id="review-test-title" class="review-sidebar-test">Subject Test #1</div>
                    <div class="review-sidebar-progress">
                        <div class="review-pill correct">
                            <span class="dot"></span>
                            <span>Correct</span>
                            <span id="review-correct-count">0</span>
                        </div>
                        <div class="review-pill incorrect">
                            <span class="dot"></span>
                            <span>Incorrect</span>
                            <span id="review-incorrect-count">0</span>
                        </div>
                        <div class="review-pill unanswered">
                            <span class="dot"></span>
                            <span>Unanswered</span>
                            <span id="review-unanswered-count">0</span>
                        </div>
                    </div>
                </div>
                <div class="review-sidebar-filters">
                    <button id="review-filter-all" class="review-filter-btn active"
                        onclick="filterReviewQuestions('all')">All</button>
                    <button id="review-filter-correct" class="review-filter-btn"
                        onclick="filterReviewQuestions('correct')">Correct</button>
                    <button id="review-filter-incorrect" class="review-filter-btn"
                        onclick="filterReviewQuestions('incorrect')">Incorrect</button>
                    <button id="review-filter-unanswered" class="review-filter-btn"
                        onclick="filterReviewQuestions('unanswered')">Unanswered</button>
                    <button id="review-filter-tagged" class="review-filter-btn"
                        onclick="filterReviewQuestions('tagged')">Tagged</button>
                </div>
                <div class="review-sidebar-search">
                    <input id="review-search-input" type="search" placeholder="Search question text..."
                        oninput="handleReviewSearch()">
                </div>
                <div id="review-question-list" class="review-question-list"></div>
            </aside>

            <section class="review-content">
                <div class="review-content-header">
                    <div>
                        <div class="review-question-index">Question <span id="review-q-number">1</span> of <span
                                id="review-q-total">0</span></div>
                        <h1 id="review-q-stem" class="review-question-title">Question text will appear here</h1>
                    </div>
                    <div class="review-header-actions">
                        <button id="review-tag-btn" class="review-action-btn" onclick="toggleTagQuestion()">
                            <svg id="review-tag-icon" width="18" height="18" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                            </svg>
                            <span id="review-tag-text">Tag Question</span>
                        </button>
                    </div>
                </div>

                <div class="review-meta-row">
                    <div id="review-status-chip" class="review-meta-chip success">
                        <span id="review-feedback-status">Correct</span>
                    </div>
                    <div id="review-answer-chip" class="review-meta-chip neutral">
                        <span id="review-correct-answer">Correct Answer: A</span>
                    </div>
                    <div id="review-user-chip" class="review-meta-chip">
                        <span id="review-user-answer">Your Answer: --</span>
                    </div>
                    <div id="review-time-chip" class="review-meta-chip">
                        <span id="review-time-spent">Time Spent: 00:00</span>
                    </div>
                </div>

                <div id="review-q-choices" class="review-choices"></div>

                <div class="review-explanation-card">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <span>Explanation</span>
                    </h3>
                    <div id="review-explanation">
                        <p>Explanation will appear here.</p>
                    </div>
                </div>

                <div class="review-navigation">
                    <button class="review-nav-btn" onclick="reviewPrevQuestion()">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                        Previous Question
                    </button>
                    <div id="review-progress-count" class="review-progress-count">1 / 0</div>
                    <button class="review-nav-btn" onclick="reviewNextQuestion()">
                        Next Question
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
            </section>
        </div>

        <!-- == TAGGED QUESTIONS VIEW (Hidden by default) == -->
        <div id="tagged-questions-view" class="app-view review-layout" style="display: none;">
            <aside class="review-sidebar">
                <div class="review-sidebar-header">
                    <div class="flex items-center justify-between w-full mb-2">
                        <button class="review-back-btn" onclick="showView('dashboard-view')"
                            aria-label="Back to home">×</button>
                        <button id="tagged-questions-dark-mode-toggle" class="dark-mode-toggle-btn"
                            onclick="toggleTestReviewDarkMode()" aria-label="Toggle Dark Mode" title="Toggle Dark Mode"
                            style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                            <i data-lucide="moon" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="review-sidebar-title">Tagged Questions</div>
                    <div id="tagged-test-title" class="review-sidebar-test">All Tagged Questions</div>
                    <div class="review-sidebar-progress">
                        <div class="review-pill correct">
                            <span class="dot"></span>
                            <span>Correct</span>
                            <span id="tagged-correct-count">0</span>
                        </div>
                        <div class="review-pill incorrect">
                            <span class="dot"></span>
                            <span>Incorrect</span>
                            <span id="tagged-incorrect-count">0</span>
                        </div>
                        <div class="review-pill unanswered">
                            <span class="dot"></span>
                            <span>Unanswered</span>
                            <span id="tagged-unanswered-count">0</span>
                        </div>
                    </div>
                </div>
                <div class="review-sidebar-filters">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; padding: 0 4px; cursor: pointer;"
                        onclick="toggleTaggedSubjectFilters()">
                        <div
                            style="font-size: 11px; color: rgba(248, 250, 255, 0.6); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600;">
                            Subject</div>
                        <svg id="tagged-subject-chevron" width="14" height="14" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24"
                            style="transition: transform 0.2s ease; color: rgba(248, 250, 255, 0.6);">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </div>
                    <div id="tagged-subject-filters-list"
                        style="display: flex; flex-wrap: wrap; gap: 8px; transition: all 0.3s ease;">
                        <button id="tagged-subject-all" class="review-filter-btn active"
                            onclick="filterTaggedBySubject('all')">All Subjects</button>
                        <button id="tagged-subject-biology" class="review-filter-btn"
                            onclick="filterTaggedBySubject('Biology')">Biology</button>
                        <button id="tagged-subject-genchem" class="review-filter-btn"
                            onclick="filterTaggedBySubject('General Chemistry')">Gen Chem</button>
                        <button id="tagged-subject-ochem" class="review-filter-btn"
                            onclick="filterTaggedBySubject('Organic Chemistry')">Org Chem</button>
                        <button id="tagged-subject-reading" class="review-filter-btn"
                            onclick="filterTaggedBySubject('Reading Comprehension')">Reading</button>
                        <button id="tagged-subject-physics" class="review-filter-btn"
                            onclick="filterTaggedBySubject('Physics')">Physics</button>
                        <button id="tagged-subject-quant" class="review-filter-btn"
                            onclick="filterTaggedBySubject('Quantitative Reasoning')">Quant</button>
                    </div>
                </div>
                <div class="review-sidebar-filters"
                    style="border-top: 1px solid rgba(255, 255, 255, 0.08); padding-top: 16px;">
                    <div
                        style="font-size: 11px; color: rgba(248, 250, 255, 0.6); margin-bottom: 8px; padding: 0 4px; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600;">
                        Status</div>
                    <button id="tagged-filter-all" class="review-filter-btn active"
                        onclick="filterTaggedQuestions('all')">All</button>
                    <button id="tagged-filter-correct" class="review-filter-btn"
                        onclick="filterTaggedQuestions('correct')">Correct</button>
                    <button id="tagged-filter-incorrect" class="review-filter-btn"
                        onclick="filterTaggedQuestions('incorrect')">Incorrect</button>
                    <button id="tagged-filter-unanswered" class="review-filter-btn"
                        onclick="filterTaggedQuestions('unanswered')">Unanswered</button>
                </div>
                <div class="review-sidebar-search">
                    <input id="tagged-search-input" type="search" placeholder="Search question text..."
                        oninput="handleTaggedSearch()">
                </div>
                <div id="tagged-question-list" class="review-question-list"></div>
            </aside>

            <section class="review-content">
                <div class="review-content-header">
                    <div>
                        <div class="review-question-index">Question <span id="tagged-q-number">1</span> of <span
                                id="tagged-q-total">0</span></div>
                        <h1 id="tagged-q-stem" class="review-question-title">Question text will appear here</h1>
                    </div>
                    <div class="review-header-actions">
                        <button id="tagged-tag-btn" class="review-action-btn" onclick="toggleTagQuestionFromTagged()">
                            <svg id="tagged-tag-icon" width="18" height="18" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                            </svg>
                            <span id="tagged-tag-text">Remove Tag</span>
                        </button>
                    </div>
                </div>

                <div class="review-meta-row">
                    <div id="tagged-status-chip" class="review-meta-chip success">
                        <span id="tagged-feedback-status">Correct</span>
                    </div>
                    <div id="tagged-answer-chip" class="review-meta-chip neutral">
                        <span id="tagged-correct-answer">Correct Answer: A</span>
                    </div>
                    <div id="tagged-user-chip" class="review-meta-chip">
                        <span id="tagged-user-answer">Your Answer: --</span>
                    </div>
                    <div id="tagged-time-chip" class="review-meta-chip">
                        <span id="tagged-subject-info">Subject Test #1</span>
                    </div>
                </div>

                <div id="tagged-q-choices" class="review-choices"></div>

                <div class="review-explanation-card">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <span>Explanation</span>
                    </h3>
                    <div id="tagged-explanation">
                        <p>Explanation will appear here.</p>
                    </div>
                </div>

                <div class="review-navigation">
                    <button class="review-nav-btn" onclick="taggedPrevQuestion()">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                        Previous Question
                    </button>
                    <div id="tagged-progress-count" class="review-progress-count">1 / 0</div>
                    <button class="review-nav-btn" onclick="taggedNextQuestion()">
                        Next Question
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
            </section>
        </div>

        <!-- Periodic Table Modal -->
        <div id="periodic-table-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50"
            style="display: none;">
            <div class="bg-white rounded-lg shadow-xl w-[95%] max-w-6xl max-h-[90vh] overflow-auto">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-4 border-b border-gray-200 sticky top-0 bg-white z-10">
                    <h3 class="text-xl font-semibold text-gray-900">Periodic Table of the Elements</h3>
                    <button onclick="hideExhibit()"
                        class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
                </div>
                <!-- Periodic Table Content -->
                <div id="periodic-table-content" class="p-6">
                    <!-- Periodic table will be inserted here (image for General Chemistry, HTML for others) -->
                </div>
            </div>
        </div>

        <!-- Image Save Modal for Organic Chemistry Practice Test 1 -->
        <div id="image-save-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50"
            style="display: none;">
            <div class="bg-white rounded-lg shadow-xl w-[90%] max-w-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Save Image</h3>
                    <button onclick="hideImageSaveModal()"
                        class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
                </div>
                <p class="text-gray-700 mb-4">How would you like to save this image?</p>
                <div class="flex flex-col gap-3">
                    <button id="save-persistent-btn" onclick="saveImagePersistent()"
                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer">
                        Save to this practice test
                    </button>
                    <button id="save-temp-btn" onclick="saveImageTemporary()"
                        class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 cursor-pointer">
                        Use only for this attempt
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-4">
                    <strong>Save to this practice test:</strong> The image will persist when you reload or return
                    later.<br>
                    <strong>Use only for this attempt:</strong> The image will be removed when you leave or reload.
                </p>
            </div>
        </div>

        <!-- Custom Icon Upload Modal -->
        <div id="custom-icon-upload-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50"
            style="display: none;">
            <div class="bg-white rounded-lg shadow-xl w-[90%] max-w-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Upload Custom Icon</h3>
                    <button onclick="hideCustomIconUploadModal()"
                        class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Choose an image file (PNG, JPG, or
                        SVG)</label>
                    <input type="file" id="custom-icon-file-input" accept="image/png,image/jpeg,image/jpg,image/svg+xml"
                        class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer"
                        onchange="handleCustomIconFileSelect(event)" />
                </div>

                <div id="custom-icon-preview-container" class="mb-4" style="display: none;">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Preview</label>
                    <div class="border border-gray-300 rounded p-4 bg-gray-50 flex items-center justify-center"
                        style="min-height: 150px;">
                        <img id="custom-icon-preview" src="" alt="Icon preview"
                            style="max-width: 200px; max-height: 150px; object-fit: contain;" />
                    </div>
                </div>

                <div id="custom-icon-options" class="mb-4" style="display: none;">
                    <p class="text-gray-700 mb-3 font-medium">Do you want to save this icon permanently or use it just
                        for now?</p>
                    <div class="flex flex-col gap-3">
                        <button id="save-icon-permanent-btn" onclick="saveCustomIconPermanent()"
                            class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer font-medium">
                            Save for All Exams
                        </button>
                        <button id="save-icon-onetime-btn" onclick="saveCustomIconOneTime()"
                            class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 cursor-pointer font-medium">
                            One-Time Use
                        </button>
                        <button onclick="cancelCustomIconUpload()"
                            class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 cursor-pointer">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculator Modal -->
        <div id="calculator-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50"
            style="display: none;" onclick="if(event.target.id === 'calculator-modal') hideCalculator()">
            <div id="HistrixCalculator"
                style="width: 320px; background: #ececec; border: 2px solid #072c74; border-radius: 4px; box-shadow: 0 2px 6px rgba(0,0,0,.35); font-family: Tahoma, Arial, sans-serif; overflow: hidden;"
                onclick="event.stopPropagation()">
                <div class="header"
                    style="background:#001a9a; color:#fff; height: 24px; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; position:relative;">
                    <div>Calculator</div>
                    <button class="close" onclick="hideCalculator()"
                        style="position:absolute; right:6px; top:3px; width:18px; height:18px; background:#ff0000; border:2px solid #fff; color:#fff; line-height:14px; text-align:center; font-weight:900; border-radius:2px; cursor:pointer;">×</button>
                </div>

                <div class="calc-wrap" style="padding: 8px 8px 0;">
                    <div class="display-row" style="display:flex; gap:8px; margin-bottom:10px;">
                        <span class="mem-box"
                            style="width: 54px; background:#d8d8d8; border:1px solid #bfbfbf; border-radius:3px; height:24px; display:flex; align-items:center; justify-content:center;">
                            <input id="calc-mem" readonly value=""
                                style="border:none; background:transparent; width:100%; text-align:center; font-weight:700; color:#d46b00; padding:0; font-size:13px;" />
                        </span>
                        <input id="calc-display" readonly value="0"
                            style="flex:1; height:26px; padding:0 6px; border:1px solid #bfbfbf; border-radius:3px; background:#f7f7f7; text-align:right; font-size:16px; font-weight:700; color:#000; box-sizing:border-box;" />
                    </div>
                </div>

<<<<<<< HEAD
    <script src="db-wrapper.js"></script>
    <script src="auth/instantdb-auth.js"></script>
    <script src="genchem_tests.js"></script>
    <!-- Load exam data files -->
    <script src="Biology/exam-data.js"></script>
    <script src="General Chemistry/exam-data.js"></script>
    <script src="Organic Chemistry/exam-data.js"></script>
    <script src="Reading Comprehension/passages.js"></script>
    <script src="Reading Comprehension/exam-data.js"></script>
    <script src="Physics/exam-data.js"></script>
    <script src="Quantitative Reasoning/exam-data.js"></script>
    <script src="script.js"></script>
    <script src="init_tests.js"></script>
    
    <!-- Auth UI Integration -->
    <script type="text/babel">
        // Add auth UI to the page
        (function() {
            const { useState, useEffect } = React;
            
            function AuthUI() {
                const [showAuthModal, setShowAuthModal] = useState(false);
                const [isAuthenticated, setIsAuthenticated] = useState(
                    () => localStorage.getItem('app_auth_mode') === 'authenticated'
                );
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                const [isSignUp, setIsSignUp] = useState(true); // true = sign up, false = sign in
                const [loading, setLoading] = useState(false);
                const [error, setError] = useState('');
                const [showPassword, setShowPassword] = useState(false);
                const [isOnExamPage, setIsOnExamPage] = useState(false);
                
                const handleAuth = async (e) => {
                    e.preventDefault();
                    setLoading(true);
                    setError('');
                    
                    try {
                        let result;
                        
                        if (isSignUp) {
                            // Sign up new user
                            result = await window.InstantDBAuth.signUpWithEmail(email, password);
                        } else {
                            // Sign in existing user
                            result = await window.InstantDBAuth.signInWithEmail(email, password);
                        }
                        
                        if (result.error) {
                            setError(result.error);
                            setLoading(false);
                            return;
                        }
                        
                        // Success! Set up authenticated state
                        const user = result.user;
                        
                        window.APP_AUTH_STATE = {
                            mode: 'authenticated',
                            user: user,
                            isAuthenticated: true
                        };
                        
                        if (window.InstantDB) {
                            window.__instantDBAuthState = {
                                isAuthenticated: true,
                                userId: user.id
                            };
                        }
                        
                        localStorage.setItem('app_auth_mode', 'authenticated');
                        localStorage.setItem('app_user', JSON.stringify(user));
                        
                        // Clear biology tests for fresh start
                        clearBiologyTests();
                        
                        setIsAuthenticated(true);
                        setShowAuthModal(false);
                        setEmail('');
                        setPassword('');
                        setLoading(false);
                        
                    } catch (err) {
                        setError(err.message || 'Authentication failed. Please try again.');
                        setLoading(false);
                    }
                };
                
                const clearBiologyTests = () => {
                    // Clear all biology test data from localStorage
                    const keysToRemove = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key && key.includes('biology')) {
                            keysToRemove.push(key);
=======
                <div class="pad" style="padding: 10px;">
                    <div class="grid"
                        style="display:grid; grid-template-columns: 48px repeat(5, 40px); column-gap:6px;">
                        <!-- memory column -->
                        <div class="mem-col" style="display:flex; flex-direction:column; gap:6px;">
                            <div class="spacer" style="height:24px;"></div>
                            <div class="btn red calc-btn" data-key="MC"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                MC</div>
                            <div class="btn red calc-btn" data-key="MR"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                MR</div>
                            <div class="btn red calc-btn" data-key="MS"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                MS</div>
                            <div class="btn red calc-btn" data-key="M+"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                M+</div>
                        </div>

                        <!-- main keys: fixed 5x5 grid -->
                        <div class="keys-grid"
                            style="display:grid; grid-template-columns: repeat(5, 40px); grid-template-rows: repeat(5, 32px); gap:6px; margin-left:6px;">
                            <!-- row 1 -->
                            <div></div>
                            <div class="btn red calc-btn" data-key="Backspace"
                                style="grid-column:2 / span 2; user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                Backspace</div>
                            <div class="btn red calc-btn" data-key="CE"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                CE</div>
                            <div class="btn red calc-btn" data-key="CA"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                CA</div>

                            <!-- row 2 -->
                            <div class="btn blue calc-btn" data-key="7"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                7</div>
                            <div class="btn blue calc-btn" data-key="8"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                8</div>
                            <div class="btn blue calc-btn" data-key="9"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                9</div>
                            <div class="btn red calc-btn" data-key="/"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                /</div>
                            <div class="btn blue calc-btn" data-key="sqrt"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                sqrt</div>

                            <!-- row 3 -->
                            <div class="btn blue calc-btn" data-key="4"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                4</div>
                            <div class="btn blue calc-btn" data-key="5"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                5</div>
                            <div class="btn blue calc-btn" data-key="6"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                6</div>
                            <div class="btn red calc-btn" data-key="*"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                *</div>
                            <div class="btn blue calc-btn" data-key="%"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                %</div>

                            <!-- row 4 -->
                            <div class="btn blue calc-btn" data-key="1"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                1</div>
                            <div class="btn blue calc-btn" data-key="2"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                2</div>
                            <div class="btn blue calc-btn" data-key="3"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                3</div>
                            <div class="btn red calc-btn" data-key="-"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                -</div>
                            <div class="btn blue calc-btn" data-key="1/x"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                1/x</div>

                            <!-- row 5 -->
                            <div class="btn blue calc-btn" data-key="0"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                0</div>
                            <div class="btn blue calc-btn" data-key="+/-"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                +/-</div>
                            <div class="btn blue calc-btn" data-key="."
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                .</div>
                            <div class="btn red calc-btn" data-key="+"
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#b80000;">
                                +</div>
                            <div class="btn blue calc-btn" data-key="="
                                style="user-select:none; display:flex; align-items:center; justify-content:center; height:32px; border-radius:8px; border:1px solid #bdbdbd; background:linear-gradient(#f3f3f3, #d8d8d8); box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.18); font-size:13px; font-weight:700; cursor:pointer; color:#1133ee;">
                                =</div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Old modals removed - now using React modals -->

            <script src="db-wrapper.js"></script>
            <script src="auth/instantdb-auth.js"></script>
            <script src="genchem_tests.js"></script>
            <!-- Load exam data files -->
            <script src="Biology/exam-data.js"></script>
            <script src="General Chemistry/exam-data.js"></script>
            <script src="Organic Chemistry/exam-data.js"></script>
            <script src="Reading Comprehension/passages.js"></script>
            <script src="Reading Comprehension/exam-data.js"></script>
            <script src="Physics/exam-data.js"></script>
            <script src="Quantitative Reasoning/exam-data.js"></script>
            <script src="script.js"></script>
            <script src="init_tests.js"></script>

            <!-- Auth UI Integration -->
            <script type="text/babel">
                // Add auth UI to the page
                (function () {
                    const { useState, useEffect } = React;
                    const ADMIN_EMAIL = 'optofutureprep@gmail.com';
                    const REGISTERED_USERS_KEY = 'registered_users_list';
                    const SUPPORT_MESSAGES_KEY = 'support_messages_list';
                    const ANNOUNCEMENTS_KEY = 'admin_announcements_list';

                    const normalizeEmail = (email = '') => email.trim().toLowerCase();

                    function loadRegisteredUsers() {
                        try {
                            const stored = localStorage.getItem(REGISTERED_USERS_KEY);
                            return stored
                                ? JSON.parse(stored).map((record) => ({
                                    ...record,
                                    banned: !!record.banned,
                                    bannedAt: record.bannedAt || null,
                                }))
                                : [];
                        } catch (error) {
                            console.warn('Failed to load registered users:', error);
                            return [];
>>>>>>> 1
                        }
                    }

                    function saveRegisteredUsers(users) {
                        try {
                            localStorage.setItem(REGISTERED_USERS_KEY, JSON.stringify(users));
                        } catch (error) {
                            console.warn('Failed to save registered users:', error);
                        }
                    }

                    function upsertRegisteredUserRecord(user) {
                        const normalizedEmail = normalizeEmail(user?.email);
                        if (!normalizedEmail) {
                            return loadRegisteredUsers();
                        }

                        const existing = loadRegisteredUsers();
                        const timestamp = new Date().toISOString();
                        let alreadyExists = false;

                        const updated = existing.map((record) => {
                            if (normalizeEmail(record.email) === normalizedEmail) {
                                alreadyExists = true;
                                return {
                                    ...record,
                                    userId: user?.id || record.userId,
                                    lastLoginAt: timestamp,
                                    createdAt: record.createdAt || user?.createdAt || timestamp,
                                    banned: record?.banned || false,
                                    bannedAt: record?.bannedAt || null,
                                };
                            }
                            return record;
                        });

                        if (!alreadyExists) {
                            updated.push({
                                userId: user?.id || `user_${Date.now()}`,
                                email: user?.email,
                                createdAt: user?.createdAt || timestamp,
                                lastLoginAt: timestamp,
                                banned: false,
                                bannedAt: null,
                            });
                        }

                        saveRegisteredUsers(updated);
                        return updated;
                    }

                    function loadSupportMessages() {
                        try {
                            const stored = localStorage.getItem(SUPPORT_MESSAGES_KEY);
                            return stored ? JSON.parse(stored) : [];
                        } catch (error) {
                            console.warn('Failed to load support messages:', error);
                            return [];
                        }
                    }

                    function saveSupportMessages(messages) {
                        try {
                            localStorage.setItem(SUPPORT_MESSAGES_KEY, JSON.stringify(messages));
                        } catch (error) {
                            console.warn('Failed to save support messages:', error);
                        }
                    }

                    function addSupportMessage(message) {
                        const messages = loadSupportMessages();
                        const entry = {
                            id: `support_${Date.now()}`,
                            ...message,
                            createdAt: new Date().toISOString(),
                            status: 'open',
                            replies: []
                        };
                        const updated = [entry, ...messages];
                        saveSupportMessages(updated);
                        return updated;
                    }

                    function addSupportReply(messageId, reply) {
                        const messages = loadSupportMessages();
                        const messageIndex = messages.findIndex(msg => msg.id === messageId);
                        if (messageIndex === -1) return messages;

                        messages[messageIndex].replies = messages[messageIndex].replies || [];
                        messages[messageIndex].replies.push({
                            id: `reply_${Date.now()}`,
                            message: reply.message,
                            from: 'admin',
                            createdAt: new Date().toISOString()
                        });
                        messages[messageIndex].status = 'replied';
                        messages[messageIndex].repliedAt = new Date().toISOString();

                        saveSupportMessages(messages);
                        return messages;
                    }

                    function loadAnnouncements() {
                        try {
                            const stored = localStorage.getItem(ANNOUNCEMENTS_KEY);
                            return stored ? JSON.parse(stored) : [];
                        } catch (error) {
                            console.warn('Failed to load announcements:', error);
                            return [];
                        }
                    }

                    function saveAnnouncements(list) {
                        try {
                            localStorage.setItem(ANNOUNCEMENTS_KEY, JSON.stringify(list));
                        } catch (error) {
                            console.warn('Failed to save announcements:', error);
                        }
                    }

                    function addAnnouncement(data) {
                        const announcements = loadAnnouncements();
                        const entry = {
                            id: `announcement_${Date.now()}`,
                            title: data.title?.trim() || 'Announcement',
                            message: data.message?.trim() || '',
                            createdAt: new Date().toISOString()
                        };
                        const updated = [entry, ...announcements];
                        saveAnnouncements(updated);
                        return updated;
                    }

                    function setUserBanStatus(email, isBanned) {
                        const normalizedEmail = normalizeEmail(email);
                        if (!normalizedEmail) {
                            return loadRegisteredUsers();
                        }

                        const timestamp = new Date().toISOString();
                        const updated = loadRegisteredUsers().map((record) => {
                            if (normalizeEmail(record.email) === normalizedEmail) {
                                return {
                                    ...record,
                                    banned: isBanned,
                                    bannedAt: isBanned ? timestamp : null,
                                };
                            }
                            return record;
                        });

                        saveRegisteredUsers(updated);
                        return updated;
                    }

                    function isUserBanned(email) {
                        const record = findRegisteredUserByEmail(email);
                        return !!record?.banned;
                    }

                    function removeRegisteredUserByEmail(email) {
                        const normalizedEmail = normalizeEmail(email);
                        if (!normalizedEmail) {
                            return loadRegisteredUsers();
                        }
                        const updated = loadRegisteredUsers().filter((record) => normalizeEmail(record.email) !== normalizedEmail);
                        saveRegisteredUsers(updated);
                        return updated;
                    }

                    function getSavedUser() {
                        try {
                            const savedUser = localStorage.getItem('app_user');
                            return savedUser ? JSON.parse(savedUser) : null;
                        } catch (error) {
                            console.warn('Failed to parse saved user:', error);
                            return null;
                        }
                    }

                    function isAdminUser(user) {
                        if (!user?.email) {
                            return false;
                        }
                        return normalizeEmail(user.email) === normalizeEmail(ADMIN_EMAIL);
                    }

                    function formatDateTime(value) {
                        if (!value) {
                            return '—';
                        }
                        try {
                            const date = new Date(value);
                            return date.toLocaleString(undefined, {
                                month: 'short',
                                day: 'numeric',
                                year: 'numeric',
                                hour: 'numeric',
                                minute: '2-digit'
                            });
                        } catch (error) {
                            return value;
                        }
                    }

                    function findRegisteredUserByEmail(email) {
                        const normalized = normalizeEmail(email);
                        if (!normalized) {
                            return null;
                        }
                        const users = loadRegisteredUsers();
                        return users.find((user) => normalizeEmail(user.email) === normalized) || null;
                    }

                    const AdminDashboard = ({ users, supportMessages, announcements, onAddAnnouncement, onToggleBan, onRemoveUser, onAddSupportReply, onClose }) => {
                        const [announcementForm, setAnnouncementForm] = useState({ title: '', message: '' });
                        const [activeTab, setActiveTab] = useState('users');
                        const [replyForm, setReplyForm] = useState({});
                        const [showReplyForm, setShowReplyForm] = useState({});
                        const tabConfig = [
                            { id: 'users', label: 'Users', subtitle: 'Registrations & status', color: '#0ea5e9' },
                            { id: 'support', label: 'Support Inbox', subtitle: 'Messages from students', color: '#f97316' },
                            { id: 'announcements', label: 'Announcements', subtitle: 'Broadcast to everyone', color: '#22c55e' },
                        ];
                        const handleAnnouncementSubmit = (event) => {
                            event.preventDefault();
                            if (!announcementForm.title.trim() || !announcementForm.message.trim()) {
                                return;
                            }
                            onAddAnnouncement(announcementForm);
                            setAnnouncementForm({ title: '', message: '' });
                        };

                        const handleReplySubmit = (messageId) => {
                            const replyText = replyForm[messageId];
                            if (!replyText || !replyText.trim()) return;

                            onAddSupportReply(messageId, { message: replyText.trim() });
                            setReplyForm(prev => ({ ...prev, [messageId]: '' }));
                            setShowReplyForm(prev => ({ ...prev, [messageId]: false }));
                        };
                        const adminEmailNormalized = normalizeEmail(ADMIN_EMAIL);
                        const sortedUsers = [...users].sort((a, b) => {
                            const aTime = new Date(a.lastLoginAt || a.createdAt || 0).getTime();
                            const bTime = new Date(b.lastLoginAt || b.createdAt || 0).getTime();
                            return bTime - aTime;
                        });
                        const displayUsers = sortedUsers.filter((user) => normalizeEmail(user.email) !== adminEmailNormalized);

                        const totalUsers = displayUsers.length;
                        const recentLogin = displayUsers[0]?.lastLoginAt || displayUsers[0]?.createdAt || null;

                        return (
                            <div
                                style={{
                                    position: 'fixed',
                                    inset: 0,
                                    background: 'rgba(0,0,0,0.65)',
                                    display: 'flex',
                                    alignItems: 'flex-start',
                                    justifyContent: 'center',
                                    zIndex: 12000,
                                    backdropFilter: 'blur(4px)',
                                    overflowY: 'auto',
                                    padding: '30px 16px'
                                }}
                                onClick={onClose}
                            >
                                <div
                                    style={{
                                        background: 'linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%)',
                                        borderRadius: '22px',
                                        width: 'min(980px, 94vw)',
                                        maxHeight: 'none',
                                        padding: '32px',
                                        boxShadow: '0 30px 80px rgba(15,23,42,0.25)',
                                        overflow: 'hidden',
                                        display: 'flex',
                                        flexDirection: 'column',
                                        border: '1px solid rgba(148,163,184,0.35)'
                                    }}
                                    onClick={(e) => e.stopPropagation()}
                                >
                                    <div style={{
                                        display: 'grid',
                                        gridTemplateColumns: '1fr auto',
                                        gap: '20px',
                                        alignItems: 'start',
                                        marginBottom: '26px'
                                    }}>
                                        <div style={{
                                            background: 'linear-gradient(135deg, #0ea5e9, #6366f1)',
                                            borderRadius: '20px',
                                            padding: '24px',
                                            color: 'white',
                                            position: 'relative',
                                            overflow: 'hidden'
                                        }}>
                                            <span style={{
                                                position: 'absolute',
                                                inset: '0',
                                                background: 'radial-gradient(circle at 20% 20%, rgba(255,255,255,0.25), transparent 55%)'
                                            }}></span>
                                            <div style={{ position: 'relative' }}>
                                                <p style={{ textTransform: 'uppercase', fontSize: '12px', letterSpacing: '0.35em', color: 'rgba(255,255,255,0.8)', marginBottom: '8px' }}>Administrator</p>
                                                <h2 style={{ fontSize: '30px', fontWeight: 700, margin: 0 }}>OptoFuture Prep Dashboard</h2>
                                                <p style={{ marginTop: '10px', fontSize: '15px', lineHeight: 1.5, color: 'rgba(255,255,255,0.88)' }}>
                                                    Monitor signups, logins, and student progress markers at a glance. Use the quick actions below to manage your cohort.
                                                </p>
                                                <div style={{ display: 'flex', gap: '10px', marginTop: '16px' }}>
                                                    <span style={{
                                                        background: 'rgba(255,255,255,0.15)',
                                                        borderRadius: '999px',
                                                        padding: '6px 14px',
                                                        fontSize: '12px',
                                                        fontWeight: 600
                                                    }}>Live Overview</span>
                                                    <span style={{
                                                        background: 'rgba(255,255,255,0.15)',
                                                        borderRadius: '999px',
                                                        padding: '6px 14px',
                                                        fontSize: '12px',
                                                        fontWeight: 600
                                                    }}>Realtime Updates</span>
                                                </div>
                                            </div>
                                        </div>
                                        <button
                                            onClick={onClose}
                                            style={{
                                                border: 'none',
                                                background: '#f8fafc',
                                                color: '#0f172a',
                                                borderRadius: '18px',
                                                width: '54px',
                                                height: '54px',
                                                fontSize: '24px',
                                                cursor: 'pointer',
                                                boxShadow: '0 10px 25px rgba(15,23,42,0.15)'
                                            }}
                                            title="Close dashboard"
                                        >
                                            ×
                                        </button>
                                    </div>

                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(220px, 1fr))', gap: '18px', marginBottom: '26px' }}>
                                        <div style={{
                                            background: 'linear-gradient(135deg, #f97316, #fb7185)',
                                            color: 'white',
                                            borderRadius: '18px',
                                            padding: '18px',
                                            position: 'relative',
                                            overflow: 'hidden'
                                        }}>
                                            <span style={{ position: 'absolute', top: '-24px', right: '-24px', width: '120px', height: '120px', background: 'rgba(255,255,255,0.15)', borderRadius: '50%' }}></span>
                                            <div style={{ position: 'relative' }}>
                                                <p style={{ margin: 0, fontSize: '13px', opacity: 0.85 }}>Total Registered Students</p>
                                                <p style={{ margin: '12px 0 0', fontSize: '36px', fontWeight: 700 }}>{totalUsers}</p>
                                                <p style={{ margin: '4px 0 0', fontSize: '12px', opacity: 0.8 }}>auto-sync • InstantDB mock</p>
                                            </div>
                                        </div>
                                        <div style={{
                                            background: 'linear-gradient(135deg, #34d399, #10b981)',
                                            borderRadius: '18px',
                                            padding: '18px',
                                            color: '#042f2e'
                                        }}>
                                            <p style={{ margin: 0, fontSize: '13px', color: 'rgba(4,47,46,0.85)' }}>Most Recent Login</p>
                                            <p style={{ margin: '12px 0 4px', fontSize: '20px', fontWeight: 700 }}>
                                                {recentLogin ? formatDateTime(recentLogin) : 'No logins yet'}
                                            </p>
                                            <p style={{ margin: 0, fontSize: '12px', color: 'rgba(4,47,46,0.7)' }}>Updates every session</p>
                                        </div>
                                    </div>

                                    <div style={{
                                        borderRadius: '18px',
                                        background: 'rgba(255,255,255,0.8)',
                                        padding: '18px',
                                        border: '1px solid rgba(148,163,184,0.35)',
                                        boxShadow: '0 15px 45px rgba(15,23,42,0.15)',
                                        flex: 'none',
                                        display: 'flex',
                                        flexDirection: 'column',
                                        minHeight: '520px'
                                    }}>
                                        <div style={{ display: 'flex', gap: '12px', marginBottom: '18px', flexWrap: 'wrap' }}>
                                            {tabConfig.map((tab) => (
                                                <button
                                                    key={tab.id}
                                                    onClick={() => setActiveTab(tab.id)}
                                                    style={{
                                                        flex: '1 1 160px',
                                                        minWidth: '140px',
                                                        background: activeTab === tab.id ? tab.color : '#f8fafc',
                                                        color: activeTab === tab.id ? 'white' : '#0f172a',
                                                        border: 'none',
                                                        borderRadius: '14px',
                                                        padding: '12px 16px',
                                                        cursor: 'pointer',
                                                        boxShadow: activeTab === tab.id ? '0 8px 25px rgba(14,165,233,0.3)' : 'none',
                                                        textAlign: 'left'
                                                    }}
                                                >
                                                    <span style={{ display: 'block', fontWeight: 700, fontSize: '15px' }}>{tab.label}</span>
                                                    <span style={{ fontSize: '12px', opacity: activeTab === tab.id ? 0.9 : 0.6 }}>{tab.subtitle}</span>
                                                </button>
                                            ))}
                                        </div>

                                        <div style={{ flex: 1, overflow: 'hidden', borderRadius: '16px', border: '1px solid #e2e8f0', background: 'white' }}>
                                            {activeTab === 'users' && (
                                                <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
                                                    <div style={{ padding: '16px 20px', borderBottom: '1px solid #e2e8f0', background: '#f8fafc' }}>
                                                        <h3 style={{ margin: 0, fontSize: '18px', color: '#0f172a' }}>Registered Users</h3>
                                                        <p style={{ margin: '4px 0 0', fontSize: '13px', color: '#64748b' }}>Review every account, status, and activity.</p>
                                                    </div>
                                                    <div style={{ flex: 1, overflow: 'auto', maxHeight: '60vh' }}>
                                                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                                            <thead>
                                                                <tr style={{ background: '#f8fafc' }}>
                                                                    <th style={{ textAlign: 'left', padding: '12px 16px', fontSize: '13px', color: '#475569', fontWeight: 600 }}>Email</th>
                                                                    <th style={{ textAlign: 'left', padding: '12px 16px', fontSize: '13px', color: '#475569', fontWeight: 600 }}>User ID</th>
                                                                    <th style={{ textAlign: 'left', padding: '12px 16px', fontSize: '13px', color: '#475569', fontWeight: 600 }}>Created</th>
                                                                    <th style={{ textAlign: 'left', padding: '12px 16px', fontSize: '13px', color: '#475569', fontWeight: 600 }}>Last Login</th>
                                                                    <th style={{ textAlign: 'left', padding: '12px 16px', fontSize: '13px', color: '#475569', fontWeight: 600 }}>Status</th>
                                                                    <th style={{ textAlign: 'left', padding: '12px 16px', fontSize: '13px', color: '#475569', fontWeight: 600 }}>Actions</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {displayUsers.length === 0 ? (
                                                                    <tr>
                                                                        <td colSpan="6" style={{ padding: '32px 16px', textAlign: 'center', color: '#94a3b8', fontSize: '14px' }}>
                                                                            No registered users yet. Sign in to populate this list.
                                                                        </td>
                                                                    </tr>
                                                                ) : (
                                                                    displayUsers.map((user, index) => {
                                                                        const banned = !!user.banned;
                                                                        return (
                                                                            <tr key={`${user.email}-${index}`} style={{ borderTop: '1px solid #edf2f7' }}>
                                                                                <td style={{ padding: '14px 16px', fontSize: '14px', color: '#0f172a', fontWeight: 600 }}>{user.email}</td>
                                                                                <td style={{ padding: '14px 16px', fontSize: '13px', color: '#475569' }}>{user.userId}</td>
                                                                                <td style={{ padding: '14px 16px', fontSize: '13px', color: '#475569' }}>{formatDateTime(user.createdAt)}</td>
                                                                                <td style={{ padding: '14px 16px', fontSize: '13px', color: '#475569' }}>{formatDateTime(user.lastLoginAt)}</td>
                                                                                <td style={{ padding: '14px 16px', fontSize: '13px' }}>
                                                                                    <span style={{
                                                                                        padding: '4px 10px',
                                                                                        borderRadius: '999px',
                                                                                        fontWeight: 600,
                                                                                        fontSize: '12px',
                                                                                        color: banned ? '#b91c1c' : '#15803d',
                                                                                        background: banned ? '#fee2e2' : '#dcfce7',
                                                                                    }}>
                                                                                        {banned ? 'Banned' : 'Active'}
                                                                                    </span>
                                                                                </td>
                                                                                <td style={{ padding: '14px 16px' }}>
                                                                                    <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                                                                                        <button
                                                                                            onClick={() => onToggleBan(user.email, !banned)}
                                                                                            style={{
                                                                                                border: 'none',
                                                                                                borderRadius: '8px',
                                                                                                padding: '6px 12px',
                                                                                                cursor: 'pointer',
                                                                                                fontWeight: 600,
                                                                                                fontSize: '12px',
                                                                                                background: banned ? '#e0f2fe' : '#fee2e2',
                                                                                                color: banned ? '#0369a1' : '#b91c1c',
                                                                                            }}
                                                                                        >
                                                                                            {banned ? 'Unban' : 'Ban'}
                                                                                        </button>
                                                                                        <button
                                                                                            onClick={() => onRemoveUser(user.email)}
                                                                                            style={{
                                                                                                border: 'none',
                                                                                                borderRadius: '8px',
                                                                                                padding: '6px 12px',
                                                                                                cursor: 'pointer',
                                                                                                fontWeight: 600,
                                                                                                fontSize: '12px',
                                                                                                background: '#fee2e2',
                                                                                                color: '#b91c1c'
                                                                                            }}
                                                                                        >
                                                                                            Remove
                                                                                        </button>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                        );
                                                                    })
                                                                )}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            )}

                                            {activeTab === 'support' && (
                                                <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
                                                    <div style={{ padding: '16px 20px', borderBottom: '1px solid #e2e8f0', background: '#fff7ed' }}>
                                                        <h3 style={{ margin: 0, fontSize: '18px', color: '#9a3412' }}>Support Messages</h3>
                                                        <p style={{ margin: '4px 0 0', fontSize: '13px', color: '#c2410c' }}>{supportMessages.length} messages • newest first</p>
                                                    </div>
                                                    <div style={{ flex: 1, overflow: 'auto', padding: '16px 20px' }}>
                                                        {supportMessages.length === 0 ? (
                                                            <p style={{ color: '#cbd5f5', fontSize: '14px', color: '#475569' }}>No support messages yet.</p>
                                                        ) : (
                                                            supportMessages.map((msg) => (
                                                                <div key={msg.id} style={{ borderBottom: '1px solid #f1f5f9', padding: '12px 0' }}>
                                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '6px' }}>
                                                                        <strong style={{ color: '#0f172a' }}>{msg.email}</strong>
                                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                                            <span style={{
                                                                                fontSize: '11px',
                                                                                padding: '2px 8px',
                                                                                borderRadius: '12px',
                                                                                background: msg.status === 'replied' ? '#dcfce7' : '#fef3c7',
                                                                                color: msg.status === 'replied' ? '#166534' : '#92400e'
                                                                            }}>
                                                                                {msg.status === 'replied' ? 'Replied' : 'Open'}
                                                                            </span>
                                                                            <span style={{ fontSize: '12px', color: '#94a3b8' }}>{formatDateTime(msg.createdAt)}</span>
                                                                        </div>
                                                                    </div>
                                                                    {msg.subject && <p style={{ margin: '0 0 4px', fontSize: '14px', color: '#0b4766', fontWeight: 600 }}>{msg.subject}</p>}
                                                                    <p style={{ margin: '0 0 8px', fontSize: '14px', color: '#475569', whiteSpace: 'pre-line' }}>{msg.message}</p>

                                                                    {/* Display existing replies */}
                                                                    {msg.replies && msg.replies.length > 0 && (
                                                                        <div style={{ marginLeft: '20px', marginTop: '8px' }}>
                                                                            {msg.replies.map((reply) => (
                                                                                <div key={reply.id} style={{
                                                                                    background: '#f8fafc',
                                                                                    border: '1px solid #e2e8f0',
                                                                                    borderRadius: '8px',
                                                                                    padding: '8px 12px',
                                                                                    marginBottom: '6px'
                                                                                }}>
                                                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '4px' }}>
                                                                                        <span style={{ fontSize: '12px', fontWeight: 600, color: '#1e40af' }}>Admin Reply</span>
                                                                                        <span style={{ fontSize: '11px', color: '#64748b' }}>{formatDateTime(reply.createdAt)}</span>
                                                                                    </div>
                                                                                    <p style={{ margin: 0, fontSize: '13px', color: '#475569', whiteSpace: 'pre-line' }}>{reply.message}</p>
                                                                                </div>
                                                                            ))}
                                                                        </div>
                                                                    )}

                                                                    {/* Reply form */}
                                                                    {!showReplyForm[msg.id] ? (
                                                                        <button
                                                                            onClick={() => setShowReplyForm(prev => ({ ...prev, [msg.id]: true }))}
                                                                            style={{
                                                                                fontSize: '12px',
                                                                                padding: '6px 12px',
                                                                                background: '#3b82f6',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '6px',
                                                                                cursor: 'pointer',
                                                                                marginTop: '8px'
                                                                            }}
                                                                        >
                                                                            Reply
                                                                        </button>
                                                                    ) : (
                                                                        <div style={{ marginTop: '8px' }}>
                                                                            <textarea
                                                                                value={replyForm[msg.id] || ''}
                                                                                onChange={(e) => setReplyForm(prev => ({ ...prev, [msg.id]: e.target.value }))}
                                                                                placeholder="Type your reply..."
                                                                                style={{
                                                                                    width: '100%',
                                                                                    padding: '8px 12px',
                                                                                    border: '1px solid #d1d5db',
                                                                                    borderRadius: '6px',
                                                                                    fontSize: '13px',
                                                                                    minHeight: '60px',
                                                                                    resize: 'vertical',
                                                                                    marginBottom: '8px'
                                                                                }}
                                                                            />
                                                                            <div style={{ display: 'flex', gap: '8px' }}>
                                                                                <button
                                                                                    onClick={() => handleReplySubmit(msg.id)}
                                                                                    style={{
                                                                                        fontSize: '12px',
                                                                                        padding: '6px 12px',
                                                                                        background: '#10b981',
                                                                                        color: 'white',
                                                                                        border: 'none',
                                                                                        borderRadius: '6px',
                                                                                        cursor: 'pointer'
                                                                                    }}
                                                                                >
                                                                                    Send Reply
                                                                                </button>
                                                                                <button
                                                                                    onClick={() => {
                                                                                        setShowReplyForm(prev => ({ ...prev, [msg.id]: false }));
                                                                                        setReplyForm(prev => ({ ...prev, [msg.id]: '' }));
                                                                                    }}
                                                                                    style={{
                                                                                        fontSize: '12px',
                                                                                        padding: '6px 12px',
                                                                                        background: '#6b7280',
                                                                                        color: 'white',
                                                                                        border: 'none',
                                                                                        borderRadius: '6px',
                                                                                        cursor: 'pointer'
                                                                                    }}
                                                                                >
                                                                                    Cancel
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            ))
                                                        )}
                                                    </div>
                                                </div>
                                            )}

                                            {activeTab === 'announcements' && (
                                                <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
                                                    <div style={{ padding: '16px 20px', borderBottom: '1px solid #e2e8f0', background: '#ecfdf5' }}>
                                                        <h3 style={{ margin: 0, fontSize: '18px', color: '#065f46' }}>Announcements</h3>
                                                        <p style={{ margin: '4px 0 0', fontSize: '13px', color: '#059669' }}>Post updates that every student will see.</p>
                                                    </div>
                                                    <div style={{ padding: '18px 20px', borderBottom: '1px solid #e2e8f0' }}>
                                                        <form onSubmit={handleAnnouncementSubmit} style={{ display: 'grid', gap: '10px' }}>
                                                            <input
                                                                type="text"
                                                                value={announcementForm.title}
                                                                placeholder="Announcement title"
                                                                onChange={(e) => setAnnouncementForm((prev) => ({ ...prev, title: e.target.value }))}
                                                                style={{ padding: '10px 12px', borderRadius: '10px', border: '1px solid #d1fae5' }}
                                                                required
                                                            />
                                                            <textarea
                                                                value={announcementForm.message}
                                                                placeholder="Write announcement..."
                                                                onChange={(e) => setAnnouncementForm((prev) => ({ ...prev, message: e.target.value }))}
                                                                style={{ padding: '12px', borderRadius: '10px', border: '1px solid #d1fae5', minHeight: '80px', resize: 'vertical' }}
                                                                required
                                                            />
                                                            <button
                                                                type="submit"
                                                                style={{
                                                                    border: 'none',
                                                                    borderRadius: '10px',
                                                                    padding: '10px 16px',
                                                                    cursor: 'pointer',
                                                                    fontWeight: 600,
                                                                    fontSize: '14px',
                                                                    background: 'linear-gradient(135deg, #0b4766, #0e5c84)',
                                                                    color: 'white'
                                                                }}
                                                            >
                                                                Publish Announcement
                                                            </button>
                                                        </form>
                                                    </div>
                                                    <div style={{ flex: 1, overflow: 'auto', padding: '16px 20px', display: 'flex', flexDirection: 'column', gap: '14px' }}>
                                                        {announcements.length === 0 ? (
                                                            <p style={{ color: '#94a3b8', fontSize: '14px', margin: 0 }}>No announcements yet.</p>
                                                        ) : (
                                                            announcements.map((item) => (
                                                                <div key={item.id} style={{ border: '1px solid #e2e8f0', borderRadius: '12px', padding: '12px 14px', background: '#f8fafc' }}>
                                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '6px' }}>
                                                                        <strong style={{ color: '#0b4766' }}>{item.title}</strong>
                                                                        <span style={{ fontSize: '12px', color: '#94a3b8' }}>{formatDateTime(item.createdAt)}</span>
                                                                    </div>
                                                                    <p style={{ margin: 0, fontSize: '14px', color: '#475569', whiteSpace: 'pre-line' }}>{item.message}</p>
                                                                </div>
                                                            ))
                                                        )}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    };

                    function AuthUI() {
                        const [showAuthModal, setShowAuthModal] = useState(false);
                        const [isAuthenticated, setIsAuthenticated] = useState(
                            () => localStorage.getItem('app_auth_mode') === 'authenticated'
                        );
                        const [email, setEmail] = useState('');
                        const [password, setPassword] = useState('');
                        const [isSignUp, setIsSignUp] = useState(true); // true = sign up, false = sign in
                        const [loading, setLoading] = useState(false);
                        const [error, setError] = useState('');
                        const [showPassword, setShowPassword] = useState(false);
                        const [isOnExamPage, setIsOnExamPage] = useState(false);
                        const [isAdmin, setIsAdmin] = useState(() => isAdminUser(getSavedUser()));
                        const [registeredUsers, setRegisteredUsers] = useState(() => loadRegisteredUsers());
                        const [showAdminDashboard, setShowAdminDashboard] = useState(false);
                        const [showSupportModal, setShowSupportModal] = useState(false);
                        const [showMySupportModal, setShowMySupportModal] = useState(false);
                        const [supportForm, setSupportForm] = useState({ email: '', subject: '', message: '' });
                        const [supportMessages, setSupportMessages] = useState(() => loadSupportMessages());
                        const [announcements, setAnnouncements] = useState(() => loadAnnouncements());
                        const [accountCollapsed, setAccountCollapsed] = useState(false);
                        const [showAnnouncementsModal, setShowAnnouncementsModal] = useState(false);

                        const handleAuth = async (e) => {
                            e.preventDefault();
                            setLoading(true);
                            setError('');

                            try {
                                let result;
                                if (isSignUp) {
                                    const existingUser = findRegisteredUserByEmail(email);
                                    if (existingUser) {
                                        if (existingUser.banned) {
                                            setError('This account has been banned. Please contact support.');
                                        } else {
                                            setError('Account already exists. Please sign in instead.');
                                        }
                                        setLoading(false);
                                        setIsSignUp(false);
                                        return;
                                    }
                                    result = await window.InstantDBAuth.signUpWithEmail(email, password);
                                } else {
                                    const existingUser = findRegisteredUserByEmail(email);
                                    if (!existingUser) {
                                        setError('No account found. Please create one.');
                                        setLoading(false);
                                        setIsSignUp(true);
                                        return;
                                    }
                                    if (existingUser.banned) {
                                        setError('This account has been banned. Please contact support.');
                                        setLoading(false);
                                        return;
                                    }
                                    result = await window.InstantDBAuth.signInWithEmail(email, password);
                                }

                                if (result.error) {
                                    setError(result.error);
                                    setLoading(false);
                                    return;
                                }

                                // Success! Set up authenticated state
                                const user = result.user;
                                const adminStatus = isAdminUser(user);
                                const updatedUsers = upsertRegisteredUserRecord(user);

                                window.APP_AUTH_STATE = {
                                    mode: 'authenticated',
                                    user: user,
                                    isAuthenticated: true
                                };

                                if (window.InstantDB) {
                                    window.__instantDBAuthState = {
                                        isAuthenticated: true,
                                        userId: user.id
                                    };
                                }

                                localStorage.setItem('app_auth_mode', 'authenticated');
                                localStorage.setItem('app_user', JSON.stringify(user));

                                // Clear biology tests for fresh start
                                clearBiologyTests();

                                setRegisteredUsers(updatedUsers);
                                setIsAdmin(adminStatus);
                                setIsAuthenticated(true);
                                setShowAuthModal(false);
                                setEmail('');
                                setPassword('');
                                setLoading(false);
                                setSupportForm((prev) => ({ ...prev, email: user.email || '' }));

                                if (adminStatus) {
                                    setShowAdminDashboard(true);
                                }

                            } catch (err) {
                                setError(err.message || 'Authentication failed. Please try again.');
                                setLoading(false);
                            }
                        };

                        const clearBiologyTests = () => {
                            // Clear all biology test data from localStorage
                            const keysToRemove = [];
                            for (let i = 0; i < localStorage.length; i++) {
                                const key = localStorage.key(i);
                                if (key && key.includes('biology')) {
                                    keysToRemove.push(key);
                                }
                            }
                            keysToRemove.forEach(key => localStorage.removeItem(key));

                            // Clear biology from sessionStorage
                            const sessionKeysToRemove = [];
                            for (let i = 0; i < sessionStorage.length; i++) {
                                const key = sessionStorage.key(i);
                                if (key && key.includes('biology')) {
                                    sessionKeysToRemove.push(key);
                                }
                            }
                            sessionKeysToRemove.forEach(key => sessionStorage.removeItem(key));

                            // Clear biology tests using InstantDB wrapper if available
                            if (window.InstantDB && window.InstantDB.clearTestState) {
                                // Clear all biology tests (assuming test indices 1-10)
                                for (let i = 1; i <= 10; i++) {
                                    try {
                                        window.InstantDB.clearTestState('biology', i);
                                    } catch (e) {
                                        console.log('Cleared biology test', i);
                                    }
                                }
                            }

                            console.log('✓ Biology tests reset - fresh start!');
                        };


                        const handleSignOut = () => {
                            window.APP_AUTH_STATE = {
                                mode: 'guest',
                                user: null,
                                isAuthenticated: false
                            };

                            localStorage.removeItem('app_auth_mode');
                            localStorage.removeItem('app_user');
                            sessionStorage.clear();

                            if (window.InstantDB) {
                                window.__instantDBAuthState = {
                                    isAuthenticated: false,
                                    userId: null
                                };
                            }

                            // Clear biology tests when signing out
                            clearBiologyTests();

                            setIsAuthenticated(false);
                            setIsAdmin(false);
                            setShowAdminDashboard(false);
                            setAccountCollapsed(false);
                        };

                        const handleGuestMode = () => {
                            window.APP_AUTH_STATE = {
                                mode: 'guest',
                                user: null,
                                isAuthenticated: false
                            };

                            sessionStorage.setItem('app_auth_mode', 'guest');

                            if (window.InstantDB) {
                                window.__instantDBAuthState = {
                                    isAuthenticated: false,
                                    userId: null
                                };
                            }

                            // Clear biology tests for guest users - fresh start
                            clearBiologyTests();

                            setShowAuthModal(false);
                        };

                        const handleToggleBan = (email, shouldBan) => {
                            const updated = setUserBanStatus(email, shouldBan);
                            setRegisteredUsers(updated);
                            if (shouldBan && normalizeEmail(email) === normalizeEmail(getSavedUser()?.email)) {
                                handleSignOut();
                            }
                        };

                        const handleAddAnnouncement = (announcement) => {
                            const updated = addAnnouncement(announcement);
                            setAnnouncements(updated);
                        };

                        const handleAddSupportReply = (messageId, reply) => {
                            const updated = addSupportReply(messageId, reply);
                            setSupportMessages(updated);
                        };

                        const handleRemoveUser = (email) => {
                            const updated = removeRegisteredUserByEmail(email);
                            setRegisteredUsers(updated);
                            if (normalizeEmail(email) === normalizeEmail(getSavedUser()?.email)) {
                                handleSignOut();
                            }
                        };

                        // Load auth state on mount
                        useEffect(() => {
                            const savedMode = localStorage.getItem('app_auth_mode');
                            const savedUser = localStorage.getItem('app_user');

                            if (savedMode === 'authenticated' && savedUser) {
                                const user = JSON.parse(savedUser);
                                window.APP_AUTH_STATE = {
                                    mode: 'authenticated',
                                    user: user,
                                    isAuthenticated: true
                                };

                                if (window.InstantDB) {
                                    window.__instantDBAuthState = {
                                        isAuthenticated: true,
                                        userId: user.id
                                    };
                                }

                                const updatedUsers = upsertRegisteredUserRecord(user);
                                setRegisteredUsers(updatedUsers);
                                setIsAdmin(isAdminUser(user));
                                setIsAuthenticated(true);
                            } else {
                                setRegisteredUsers(loadRegisteredUsers());
                                if (!savedMode && !sessionStorage.getItem('app_auth_mode')) {
                                    // First time - show modal
                                    setTimeout(() => setShowAuthModal(true), 500);
                                }
                            }
                            const savedSupportMessages = loadSupportMessages();
                            setSupportMessages(savedSupportMessages);
                            setAnnouncements(loadAnnouncements());
                            setSupportForm((prev) => ({ ...prev, email: getSavedUser()?.email || '' }));
                            setAccountCollapsed(false);
                        }, []);

                        // Monitor page changes to hide auth UI on exam pages AND pre-testing
                        useEffect(() => {
                            const checkPageType = () => {
                                // Check if we're on an exam page or pre-testing intro
                                const examContainer = document.getElementById('exam-container');
                                const introView = document.getElementById('intro-view');
                                const preTestInstructionsView = document.getElementById('pre-test-instructions-view');
                                const testView = document.getElementById('test-view');
                                const reviewView = document.getElementById('review-view');
                                const detailedReviewView = document.getElementById('detailed-review-view');
                                const taggedQuestionsView = document.getElementById('tagged-questions-view');

                                // Helper function to check if element is visible
                                const isElementVisible = (element) => {
                                    if (!element) return false;
                                    const style = window.getComputedStyle(element);
                                    return style.display !== 'none' &&
                                        style.visibility !== 'hidden' &&
                                        style.opacity !== '0' &&
                                        element.offsetWidth > 0 &&
                                        element.offsetHeight > 0;
                                };

                                // We're on exam/testing page if exam-container is visible OR any test views are visible
                                const examContainerVisible = isElementVisible(examContainer);
                                const introVisible = isElementVisible(introView);
                                const preTestVisible = isElementVisible(preTestInstructionsView);
                                const testVisible = isElementVisible(testView);
                                const reviewVisible = isElementVisible(reviewView);
                                const detailedVisible = isElementVisible(detailedReviewView);
                                const taggedVisible = isElementVisible(taggedQuestionsView);

                                // Hide auth UI if any exam-related view is visible (including pre-testing/intro and tagged questions)
                                const onExam = examContainerVisible || introVisible || preTestVisible || testVisible || reviewVisible || detailedVisible || taggedVisible;

                                setIsOnExamPage(!!onExam);
                            };

                            // Check initially
                            checkPageType();

                            // Set up observer to watch for DOM changes
                            const observer = new MutationObserver(checkPageType);
                            observer.observe(document.body, {
                                childList: true,
                                subtree: true,
                                attributes: true,
                                attributeFilter: ['style', 'class']
                            });

                            // Also check on interval as backup
                            const interval = setInterval(checkPageType, 500);

                            return () => {
                                observer.disconnect();
                                clearInterval(interval);
                            };
                        }, []);

                        const closeModal = () => {
                            if (!loading) {
                                setShowAuthModal(false);
                                setError('');
                            }
                        };

                        // Don't render anything on exam pages
                        if (isOnExamPage) {
                            return null;
                        }

                        return (
                            <div style={{ position: 'fixed', top: '20px', right: '20px', zIndex: 10000 }}>
                                {isAuthenticated ? (
                                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '10px', minWidth: '220px' }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', justifyContent: 'flex-end' }}>
                                            <button
                                                onClick={() => setAccountCollapsed((prev) => !prev)}
                                                style={{
                                                    border: 'none',
                                                    background: '#0f172a',
                                                    color: 'white',
                                                    width: '30px',
                                                    height: '30px',
                                                    borderRadius: '8px',
                                                    cursor: 'pointer',
                                                    fontSize: '18px',
                                                    lineHeight: '1'
                                                }}
                                                title={accountCollapsed ? 'Expand account controls' : 'Collapse account controls'}
                                            >
                                                {accountCollapsed ? '+' : '−'}
                                            </button>
                                            <span style={{ fontSize: '13px', color: '#0f172a', fontWeight: 600 }}>Account Controls</span>
                                        </div>
                                        {!accountCollapsed && (
                                            <>
                                                <div style={{
                                                    background: '#10b981',
                                                    color: 'white',
                                                    padding: '8px 12px',
                                                    borderRadius: '8px',
                                                    boxShadow: '0 2px 8px rgba(16, 185, 129, 0.3)',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '8px',
                                                    cursor: 'pointer',
                                                    transition: 'all 0.2s'
                                                }}
                                                    onClick={handleSignOut}
                                                    onMouseOver={(e) => {
                                                        e.currentTarget.style.background = '#059669';
                                                        e.currentTarget.style.transform = 'translateY(-1px)';
                                                    }}
                                                    onMouseOut={(e) => {
                                                        e.currentTarget.style.background = '#10b981';
                                                        e.currentTarget.style.transform = 'translateY(0)';
                                                    }}
                                                    title="Click to sign out">
                                                    <svg style={{ width: '16px', height: '16px' }} fill="currentColor" viewBox="0 0 20 20">
                                                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                                    </svg>
                                                    <span style={{ fontWeight: 600, fontSize: '13px' }}>Signed In</span>
                                                </div>
                                                <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap', justifyContent: 'flex-end' }}>
                                                    {!isAdmin && (
                                                        <button
                                                            onClick={() => setShowSupportModal(true)}
                                                            style={{
                                                                background: '#0f172a',
                                                                color: 'white',
                                                                padding: '9px 14px',
                                                                borderRadius: '10px',
                                                                border: 'none',
                                                                fontWeight: 600,
                                                                fontSize: '12px',
                                                                cursor: 'pointer'
                                                            }}
                                                        >
                                                            Contact Support
                                                        </button>
                                                    )}
                                                    {!isAdmin && (
                                                        <button
                                                            onClick={() => setShowMySupportModal(true)}
                                                            style={{
                                                                background: '#6366f1',
                                                                color: 'white',
                                                                padding: '9px 14px',
                                                                borderRadius: '10px',
                                                                border: 'none',
                                                                fontWeight: 600,
                                                                fontSize: '12px',
                                                                cursor: 'pointer'
                                                            }}
                                                        >
                                                            My Support Requests
                                                        </button>
                                                    )}
                                                    <button
                                                        onClick={() => setShowAnnouncementsModal(true)}
                                                        style={{
                                                            background: '#1d4ed8',
                                                            color: 'white',
                                                            padding: '9px 14px',
                                                            borderRadius: '10px',
                                                            border: 'none',
                                                            fontWeight: 600,
                                                            fontSize: '12px',
                                                            cursor: 'pointer'
                                                        }}
                                                    >
                                                        Announcements
                                                    </button>
                                                    {isAdmin && (
                                                        <button
                                                            onClick={() => setShowAdminDashboard(true)}
                                                            style={{
                                                                background: 'linear-gradient(135deg, #0b4766, #0e5c84)',
                                                                color: 'white',
                                                                padding: '10px 16px',
                                                                borderRadius: '10px',
                                                                border: 'none',
                                                                fontWeight: 600,
                                                                fontSize: '13px',
                                                                cursor: 'pointer',
                                                                boxShadow: '0 6px 16px rgba(11, 71, 102, 0.3)'
                                                            }}
                                                        >
                                                            Open Admin Dashboard
                                                        </button>
                                                    )}
                                                </div>
                                            </>
                                        )}
                                    </div>
                                ) : (
                                    <button
                                        onClick={() => setShowAuthModal(true)}
                                        style={{
                                            background: 'linear-gradient(135deg, #0e5c84 0%, #0b4766 100%)',
                                            color: 'white',
                                            padding: '12px 20px',
                                            borderRadius: '12px',
                                            border: 'none',
                                            fontWeight: 600,
                                            fontSize: '14px',
                                            cursor: 'pointer',
                                            boxShadow: '0 4px 12px rgba(14, 92, 132, 0.3)',
                                            transition: 'transform 0.2s, box-shadow 0.2s'
                                        }}
                                        onMouseOver={(e) => {
                                            e.target.style.transform = 'translateY(-2px)';
                                            e.target.style.boxShadow = '0 6px 16px rgba(14, 92, 132, 0.4)';
                                        }}
                                        onMouseOut={(e) => {
                                            e.target.style.transform = 'translateY(0)';
                                            e.target.style.boxShadow = '0 4px 12px rgba(14, 92, 132, 0.3)';
                                        }}
                                    >
                                        Account
                                    </button>
                                )}

                                {showAuthModal && (
                                    <div
                                        style={{
                                            position: 'fixed',
                                            inset: 0,
                                            background: 'rgba(0, 0, 0, 0.6)',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            zIndex: 50,
                                            backdropFilter: 'blur(4px)'
                                        }}
                                        onClick={closeModal}
                                    >
                                        <div
                                            style={{
                                                background: 'white',
                                                borderRadius: '16px',
                                                boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
                                                padding: '32px',
                                                maxWidth: '480px',
                                                width: '90%',
                                                margin: '16px'
                                            }}
                                            onClick={(e) => e.stopPropagation()}
                                        >
                                            {/* Bootcamp-style Auth Modal */}
                                            <div style={{ textAlign: 'center', marginBottom: '32px' }}>
                                                <div style={{
                                                    width: '64px',
                                                    height: '64px',
                                                    background: 'linear-gradient(135deg, #0e5c84 0%, #0b4766 100%)',
                                                    borderRadius: '50%',
                                                    margin: '0 auto 20px',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center'
                                                }}>
                                                    <svg style={{ width: '36px', height: '36px', color: 'white' }} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                        <path strokeLinecap="round" strokeLinejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                                    </svg>
                                                </div>
                                                <h2 style={{ fontSize: '28px', fontWeight: 'bold', color: '#1f2937', marginBottom: '8px' }}>
                                                    {isSignUp ? 'Create an account' : 'Welcome back'}
                                                </h2>
                                                <p style={{ color: '#6b7280', fontSize: '15px', marginBottom: '24px' }}>
                                                    {isSignUp ? 'Start preparing for your OAT exam' : 'Sign in to continue your prep'}
                                                </p>
                                            </div>

                                            {/* Error Message */}
                                            {error && (
                                                <div style={{
                                                    background: '#fef2f2',
                                                    border: '1px solid #fecaca',
                                                    color: '#991b1b',
                                                    padding: '12px 16px',
                                                    borderRadius: '8px',
                                                    marginBottom: '20px',
                                                    fontSize: '14px'
                                                }}>
                                                    {error}
                                                </div>
                                            )}

                                            {/* Auth Form */}
                                            <form onSubmit={handleAuth} style={{ marginBottom: '24px' }}>
                                                <div style={{ marginBottom: '16px' }}>
                                                    <label style={{
                                                        display: 'block',
                                                        fontSize: '14px',
                                                        fontWeight: 500,
                                                        color: '#374151',
                                                        marginBottom: '8px'
                                                    }}>
                                                        Email
                                                    </label>
                                                    <input
                                                        type="email"
                                                        value={email}
                                                        onChange={(e) => setEmail(e.target.value)}
                                                        required
                                                        style={{
                                                            width: '100%',
                                                            padding: '12px 14px',
                                                            border: '1px solid #d1d5db',
                                                            borderRadius: '8px',
                                                            fontSize: '15px',
                                                            outline: 'none',
                                                            boxSizing: 'border-box',
                                                            background: '#f9fafb'
                                                        }}
                                                        onFocus={(e) => {
                                                            e.target.style.borderColor = '#0e5c84';
                                                            e.target.style.background = '#ffffff';
                                                        }}
                                                        onBlur={(e) => {
                                                            e.target.style.borderColor = '#d1d5db';
                                                            e.target.style.background = '#f9fafb';
                                                        }}
                                                        placeholder=""
                                                    />
                                                </div>

                                                <div style={{ marginBottom: '20px' }}>
                                                    <label style={{
                                                        display: 'block',
                                                        fontSize: '14px',
                                                        fontWeight: 500,
                                                        color: '#374151',
                                                        marginBottom: '8px',
                                                        display: 'flex',
                                                        justifyContent: 'space-between',
                                                        alignItems: 'center'
                                                    }}>
                                                        <span>Password</span>
                                                        <span style={{ fontSize: '12px', color: '#9ca3af', fontWeight: 400 }}>
                                                            8+ characters
                                                        </span>
                                                    </label>
                                                    <div style={{ position: 'relative' }}>
                                                        <input
                                                            type={showPassword ? 'text' : 'password'}
                                                            value={password}
                                                            onChange={(e) => setPassword(e.target.value)}
                                                            required
                                                            minLength={8}
                                                            style={{
                                                                width: '100%',
                                                                padding: '12px 14px',
                                                                paddingRight: '44px',
                                                                border: '1px solid #d1d5db',
                                                                borderRadius: '8px',
                                                                fontSize: '15px',
                                                                outline: 'none',
                                                                boxSizing: 'border-box',
                                                                background: '#f9fafb'
                                                            }}
                                                            onFocus={(e) => {
                                                                e.target.style.borderColor = '#0e5c84';
                                                                e.target.style.background = '#ffffff';
                                                            }}
                                                            onBlur={(e) => {
                                                                e.target.style.borderColor = '#d1d5db';
                                                                e.target.style.background = '#f9fafb';
                                                            }}
                                                            placeholder=""
                                                        />
                                                        <button
                                                            type="button"
                                                            onClick={() => setShowPassword(!showPassword)}
                                                            style={{
                                                                position: 'absolute',
                                                                right: '12px',
                                                                top: '50%',
                                                                transform: 'translateY(-50%)',
                                                                background: 'none',
                                                                border: 'none',
                                                                cursor: 'pointer',
                                                                padding: '4px',
                                                                color: '#6b7280'
                                                            }}
                                                        >
                                                            {showPassword ? (
                                                                <svg style={{ width: '20px', height: '20px' }} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                                                                </svg>
                                                            ) : (
                                                                <svg style={{ width: '20px', height: '20px' }} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                                                </svg>
                                                            )}
                                                        </button>
                                                    </div>
                                                </div>



                                                <button
                                                    type="submit"
                                                    disabled={loading || !email || password.length < 8}
                                                    style={{
                                                        width: '100%',
                                                        padding: '14px',
                                                        background: (loading || !email || password.length < 8) ? '#cbd5e1' : 'linear-gradient(135deg, #0e5c84 0%, #0b4766 100%)',
                                                        color: 'white',
                                                        border: 'none',
                                                        borderRadius: '8px',
                                                        fontSize: '16px',
                                                        fontWeight: 600,
                                                        cursor: (loading || !email || password.length < 8) ? 'not-allowed' : 'pointer',
                                                        transition: 'all 0.2s'
                                                    }}
                                                >
                                                    {loading ? (isSignUp ? 'Creating account...' : 'Signing in...') : (isSignUp ? 'Create My Free Account' : 'Sign In')}
                                                </button>
                                            </form>

                                            {/* Toggle Sign In / Sign Up */}
                                            <div style={{ textAlign: 'center', marginBottom: '24px' }}>
                                                <button
                                                    onClick={() => {
                                                        setIsSignUp(!isSignUp);
                                                        setError('');
                                                    }}
                                                    style={{
                                                        background: 'none',
                                                        border: 'none',
                                                        color: '#0e5c84',
                                                        fontSize: '14px',
                                                        fontWeight: 500,
                                                        cursor: 'pointer',
                                                        textDecoration: 'none'
                                                    }}
                                                    onMouseOver={(e) => e.target.style.textDecoration = 'underline'}
                                                    onMouseOut={(e) => e.target.style.textDecoration = 'none'}
                                                >
                                                    {isSignUp ? 'I already have an account' : 'Create a new account'}
                                                </button>
                                            </div>

                                            {/* Divider */}
                                            <div style={{ position: 'relative', margin: '24px 0' }}>
                                                <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center' }}>
                                                    <div style={{ width: '100%', borderTop: '1px solid #e5e7eb' }}></div>
                                                </div>
                                                <div style={{ position: 'relative', display: 'flex', justifyContent: 'center', fontSize: '13px' }}>
                                                    <span style={{ padding: '0 12px', background: 'white', color: '#6b7280', fontWeight: 500 }}>OR</span>
                                                </div>
                                            </div>

                                            {/* Guest Mode Button */}
                                            <button
                                                onClick={handleGuestMode}
                                                style={{
                                                    width: '100%',
                                                    padding: '14px',
                                                    background: '#f3f4f6',
                                                    color: '#374151',
                                                    border: '1px solid #d1d5db',
                                                    borderRadius: '8px',
                                                    fontSize: '15px',
                                                    fontWeight: 600,
                                                    cursor: 'pointer',
                                                    transition: 'all 0.2s'
                                                }}
                                                onMouseOver={(e) => {
                                                    e.target.style.background = '#e5e7eb';
                                                    e.target.style.borderColor = '#9ca3af';
                                                }}
                                                onMouseOut={(e) => {
                                                    e.target.style.background = '#f3f4f6';
                                                    e.target.style.borderColor = '#d1d5db';
                                                }}
                                            >
                                                Continue as Guest
                                            </button>

                                        </div>
                                    </div>
                                )}
                                {showSupportModal && (
                                    <div
                                        style={{
                                            position: 'fixed',
                                            inset: 0,
                                            background: 'rgba(15,23,42,0.75)',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            zIndex: 11000,
                                            backdropFilter: 'blur(4px)'
                                        }}
                                        onClick={() => setShowSupportModal(false)}
                                    >
                                        <div
                                            style={{
                                                background: 'white',
                                                borderRadius: '16px',
                                                padding: '28px',
                                                width: 'min(500px, 92vw)',
                                                boxShadow: '0 20px 60px rgba(15,23,42,0.35)'
                                            }}
                                            onClick={(e) => e.stopPropagation()}
                                        >
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                                                <div>
                                                    <h3 style={{ margin: 0, fontSize: '22px', color: '#0f172a' }}>Contact Support</h3>
                                                    <p style={{ margin: '4px 0 0', fontSize: '14px', color: '#475569' }}>Send a message to OptoFuture Prep</p>
                                                </div>
                                                <button
                                                    onClick={() => setShowSupportModal(false)}
                                                    style={{ border: 'none', background: '#f1f5f9', borderRadius: '50%', width: '36px', height: '36px', fontSize: '18px', cursor: 'pointer' }}
                                                >
                                                    ×
                                                </button>
                                            </div>
                                            <form
                                                onSubmit={(event) => {
                                                    event.preventDefault();
                                                    if (!supportForm.email || !supportForm.message.trim()) {
                                                        setError('Please provide an email and message.');
                                                        return;
                                                    }
                                                    const updated = addSupportMessage(supportForm);
                                                    setSupportMessages(updated);
                                                    setSupportForm({ email: supportForm.email, subject: '', message: '' });
                                                    setShowSupportModal(false);
                                                    setError('Support request sent successfully.');
                                                }}
                                            >
                                                <label style={{ display: 'block', fontSize: '13px', fontWeight: 500, color: '#475569', marginBottom: '6px' }}>Email</label>
                                                <input
                                                    type="email"
                                                    value={supportForm.email}
                                                    onChange={(e) => setSupportForm((prev) => ({ ...prev, email: e.target.value }))}
                                                    required
                                                    style={{ width: '100%', padding: '12px', borderRadius: '10px', border: '1px solid #e2e8f0', marginBottom: '12px' }}
                                                />
                                                <label style={{ display: 'block', fontSize: '13px', fontWeight: 500, color: '#475569', marginBottom: '6px' }}>Subject (optional)</label>
                                                <input
                                                    type="text"
                                                    value={supportForm.subject}
                                                    onChange={(e) => setSupportForm((prev) => ({ ...prev, subject: e.target.value }))}
                                                    style={{ width: '100%', padding: '12px', borderRadius: '10px', border: '1px solid #e2e8f0', marginBottom: '12px' }}
                                                    placeholder="Tell us how we can help"
                                                />
                                                <label style={{ display: 'block', fontSize: '13px', fontWeight: 500, color: '#475569', marginBottom: '6px' }}>Message</label>
                                                <textarea
                                                    value={supportForm.message}
                                                    onChange={(e) => setSupportForm((prev) => ({ ...prev, message: e.target.value }))}
                                                    required
                                                    rows="4"
                                                    style={{ width: '100%', padding: '12px', borderRadius: '10px', border: '1px solid #e2e8f0', marginBottom: '16px', resize: 'vertical' }}
                                                    placeholder="Describe your issue"
                                                />
                                                <button
                                                    type="submit"
                                                    style={{ width: '100%', padding: '12px', borderRadius: '10px', border: 'none', background: 'linear-gradient(135deg, #0e5c84, #0b4766)', color: 'white', fontWeight: 600, fontSize: '15px', cursor: 'pointer' }}
                                                >
                                                    Send Message
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                )}
                                {showAnnouncementsModal && (
                                    <div
                                        style={{
                                            position: 'fixed',
                                            inset: 0,
                                            background: 'rgba(15,23,42,0.75)',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            zIndex: 10500,
                                            backdropFilter: 'blur(4px)'
                                        }}
                                        onClick={() => setShowAnnouncementsModal(false)}
                                    >
                                        <div
                                            style={{
                                                background: 'white',
                                                borderRadius: '16px',
                                                padding: '28px',
                                                width: 'min(520px, 92vw)',
                                                maxHeight: '85vh',
                                                overflow: 'auto',
                                                boxShadow: '0 20px 60px rgba(15,23,42,0.35)'
                                            }}
                                            onClick={(e) => e.stopPropagation()}
                                        >
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                                                <div>
                                                    <h3 style={{ margin: 0, fontSize: '22px', color: '#0f172a' }}>Announcements</h3>
                                                    <p style={{ margin: '4px 0 0', fontSize: '14px', color: '#475569' }}>Latest updates from OptoFuture Prep</p>
                                                </div>
                                                <button
                                                    onClick={() => setShowAnnouncementsModal(false)}
                                                    style={{ border: 'none', background: '#f1f5f9', borderRadius: '50%', width: '36px', height: '36px', fontSize: '18px', cursor: 'pointer' }}
                                                >
                                                    ×
                                                </button>
                                            </div>
                                            {announcements.length === 0 ? (
                                                <p style={{ color: '#94a3b8', fontSize: '14px', margin: 0 }}>No announcements yet. Check back soon!</p>
                                            ) : (
                                                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                                                    {announcements.map((item) => (
                                                        <div key={item.id} style={{ border: '1px solid #e2e8f0', borderRadius: '12px', padding: '14px 16px' }}>
                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '6px' }}>
                                                                <strong style={{ color: '#0b4766' }}>{item.title}</strong>
                                                                <span style={{ fontSize: '12px', color: '#94a3b8' }}>{formatDateTime(item.createdAt)}</span>
                                                            </div>
                                                            <p style={{ margin: 0, fontSize: '14px', color: '#475569', whiteSpace: 'pre-line' }}>{item.message}</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}
                                {showMySupportModal && (
                                    <div
                                        style={{
                                            position: 'fixed',
                                            inset: 0,
                                            background: 'rgba(15,23,42,0.75)',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            zIndex: 11000,
                                            backdropFilter: 'blur(4px)'
                                        }}
                                        onClick={() => setShowMySupportModal(false)}
                                    >
                                        <div
                                            style={{
                                                background: 'white',
                                                borderRadius: '16px',
                                                padding: '28px',
                                                width: 'min(600px, 92vw)',
                                                maxHeight: '80vh',
                                                boxShadow: '0 20px 60px rgba(15,23,42,0.35)',
                                                display: 'flex',
                                                flexDirection: 'column'
                                            }}
                                            onClick={(e) => e.stopPropagation()}
                                        >
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                                                <div>
                                                    <h3 style={{ margin: 0, fontSize: '22px', color: '#0f172a' }}>My Support Requests</h3>
                                                    <p style={{ margin: '4px 0 0', fontSize: '14px', color: '#475569' }}>View your messages and admin replies</p>
                                                </div>
                                                <button
                                                    onClick={() => setShowMySupportModal(false)}
                                                    style={{ border: 'none', background: '#f1f5f9', borderRadius: '50%', width: '36px', height: '36px', fontSize: '18px', cursor: 'pointer' }}
                                                >
                                                    ×
                                                </button>
                                            </div>
                                            <div style={{ flex: 1, overflow: 'auto', paddingRight: '8px' }}>
                                                {(() => {
                                                    const currentUserEmail = getSavedUser()?.email;
                                                    const myMessages = supportMessages.filter(msg =>
                                                        normalizeEmail(msg.email) === normalizeEmail(currentUserEmail)
                                                    );

                                                    if (myMessages.length === 0) {
                                                        return (
                                                            <div style={{ textAlign: 'center', padding: '40px 20px' }}>
                                                                <div style={{ fontSize: '48px', marginBottom: '16px' }}>📬</div>
                                                                <p style={{ color: '#64748b', fontSize: '16px', margin: 0 }}>No support requests yet</p>
                                                                <p style={{ color: '#94a3b8', fontSize: '14px', margin: '8px 0 0' }}>Send us a message and we'll respond as soon as possible.</p>
                                                            </div>
                                                        );
                                                    }

                                                    return myMessages.map((msg) => (
                                                        <div key={msg.id} style={{
                                                            border: '1px solid #e2e8f0',
                                                            borderRadius: '12px',
                                                            padding: '16px',
                                                            marginBottom: '16px',
                                                            background: '#fafbfc'
                                                        }}>
                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                                                                <div>
                                                                    {msg.subject && <h4 style={{ margin: '0 0 4px', fontSize: '16px', color: '#1e293b', fontWeight: 600 }}>{msg.subject}</h4>}
                                                                    <p style={{ margin: 0, fontSize: '12px', color: '#64748b' }}>
                                                                        Sent {formatDateTime(msg.createdAt)}
                                                                    </p>
                                                                </div>
                                                                <span style={{
                                                                    fontSize: '11px',
                                                                    padding: '4px 10px',
                                                                    borderRadius: '20px',
                                                                    background: msg.status === 'replied' ? '#dcfce7' : '#fef3c7',
                                                                    color: msg.status === 'replied' ? '#166534' : '#92400e',
                                                                    fontWeight: 500
                                                                }}>
                                                                    {msg.status === 'replied' ? 'Replied' : 'Open'}
                                                                </span>
                                                            </div>

                                                            <div style={{ marginBottom: '12px' }}>
                                                                <p style={{ margin: '0 0 4px', fontSize: '12px', fontWeight: 600, color: '#64748b' }}>Your Message:</p>
                                                                <div style={{
                                                                    background: 'white',
                                                                    padding: '12px',
                                                                    borderRadius: '8px',
                                                                    border: '1px solid #e2e8f0'
                                                                }}>
                                                                    <p style={{ margin: 0, fontSize: '14px', color: '#334155', whiteSpace: 'pre-line' }}>{msg.message}</p>
                                                                </div>
                                                            </div>

                                                            {msg.replies && msg.replies.length > 0 && (
                                                                <div>
                                                                    <p style={{ margin: '0 0 8px', fontSize: '12px', fontWeight: 600, color: '#64748b' }}>
                                                                        Admin Reply{msg.replies.length > 1 ? 's' : ''}:
                                                                    </p>
                                                                    {msg.replies.map((reply) => (
                                                                        <div key={reply.id} style={{
                                                                            background: '#f0f9ff',
                                                                            border: '1px solid #bae6fd',
                                                                            borderRadius: '8px',
                                                                            padding: '12px',
                                                                            marginBottom: '8px'
                                                                        }}>
                                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '6px' }}>
                                                                                <span style={{ fontSize: '12px', fontWeight: 600, color: '#0369a1' }}>OptoFuture Prep Admin</span>
                                                                                <span style={{ fontSize: '11px', color: '#64748b' }}>{formatDateTime(reply.createdAt)}</span>
                                                                            </div>
                                                                            <p style={{ margin: 0, fontSize: '14px', color: '#0c4a6e', whiteSpace: 'pre-line' }}>{reply.message}</p>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            )}

                                                            {msg.status === 'open' && (
                                                                <div style={{
                                                                    marginTop: '12px',
                                                                    padding: '8px',
                                                                    background: '#fef3c7',
                                                                    borderRadius: '6px',
                                                                    border: '1px solid #fbbf24'
                                                                }}>
                                                                    <p style={{ margin: 0, fontSize: '12px', color: '#92400e' }}>
                                                                        ⏳ Your request is being reviewed. We'll respond as soon as possible.
                                                                    </p>
                                                                </div>
                                                            )}
                                                        </div>
                                                    ));
                                                })()}
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {showAdminDashboard && isAdmin && (
                                    <AdminDashboard
                                        users={registeredUsers}
                                        supportMessages={supportMessages}
                                        announcements={announcements}
                                        onAddAnnouncement={handleAddAnnouncement}
                                        onToggleBan={handleToggleBan}
                                        onRemoveUser={handleRemoveUser}
                                        onAddSupportReply={handleAddSupportReply}
                                        onClose={() => setShowAdminDashboard(false)}
                                    />
                                )}
                            </div>
                        );
                    }

                    // Wait for page to load, then render
                    function renderAuthUI() {
                        try {
                            // Check if React is loaded
                            if (typeof React === 'undefined') {
                                console.warn('React not loaded yet, retrying...');
                                setTimeout(renderAuthUI, 100);
                                return;
                            }

                            if (typeof ReactDOM === 'undefined') {
                                console.warn('ReactDOM not loaded yet, retrying...');
                                setTimeout(renderAuthUI, 100);
                                return;
                            }

                            // Check if AuthUI function exists
                            if (typeof AuthUI === 'undefined') {
                                console.error('AuthUI component not defined');
                                return;
                            }

                            const container = document.createElement('div');
                            container.id = 'auth-ui-container';
                            document.body.appendChild(container);

                            // Use React 18 createRoot API instead of deprecated render
                            if (ReactDOM.createRoot) {
                                const root = ReactDOM.createRoot(container);
                                root.render(React.createElement(AuthUI));
                            } else if (ReactDOM.render) {
                                // Fallback for older React versions
                                ReactDOM.render(React.createElement(AuthUI), container);
                            } else {
                                console.error('ReactDOM is not available');
                            }
                        } catch (error) {
                            console.error('Error rendering AuthUI:', error);
                            console.error('Error stack:', error.stack);
                        }
                    }

                    // Start rendering after a delay to ensure everything is loaded
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', () => {
                            setTimeout(renderAuthUI, 500);
                        });
                    } else {
                        setTimeout(renderAuthUI, 500);
                    }
                })();
            </script>

            <!-- Load and process exam-modals-react.jsx with Babel -->
            <script>
                // Load exam modals React component (only once)
                (function () {
                    // Prevent multiple loads
                    if (window.examModalsLoading || window.examModalsLoaded) {
                        console.log('⏭️ Exam modals already loading or loaded, skipping');
                        return;
                    }
                    window.examModalsLoading = true;

                    let retryCount = 0;
                    const maxRetries = 50; // 5 seconds max wait

                    function loadExamModals() {
                        if (typeof Babel === 'undefined' || typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                            retryCount++;
                            if (retryCount > maxRetries) {
                                console.error('❌ React/Babel failed to load after ' + maxRetries + ' attempts');
                                window.examModalsLoading = false;
                                return;
                            }
                            console.log('⏳ Waiting for React/Babel to load... (' + retryCount + '/' + maxRetries + ')');
                            setTimeout(loadExamModals, 100);
                            return;
                        }
                        retryCount = 0; // Reset on success

                        fetch('components/exam-modals-react.jsx')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to load exam-modals-react.jsx: ' + response.status + ' ' + response.statusText);
                                }
                                return response.text();
                            })
                            .then(jsxCode => {
                                try {
                                    console.log('✅ Exam modals JSX loaded, transforming...');

                                    const transformedCode = Babel.transform(jsxCode, {
                                        presets: ['react'],
                                        filename: 'exam-modals-react.jsx'
                                    }).code;

                                    console.log('✅ Exam modals JSX transformed');

                                    // Execute the transformed code in a new scope to avoid conflicts
                                    (function () {
                                        const script = document.createElement('script');
                                        script.textContent = transformedCode;
                                        document.body.appendChild(script);
                                    })();

                                    // Mount the component after a short delay
                                    setTimeout(() => {
                                        if (window.ExamModalsManager) {
                                            const root = document.getElementById('exam-modals-react-root');
                                            if (root && React && ReactDOM) {
                                                // Check if already mounted
                                                if (root._examModalsRoot) {
                                                    console.log('⏭️ Exam modals already mounted, skipping');
                                                    return;
                                                }

                                                const reactRoot = ReactDOM.createRoot(root);
                                                root._examModalsRoot = reactRoot;
                                                reactRoot.render(React.createElement(window.ExamModalsManager));
                                                window.examModalsLoaded = true;
                                                console.log('✅ ExamModalsManager mounted');
                                            } else {
                                                console.error('❌ Could not find exam-modals-react-root or ReactDOM');
                                            }
                                        } else {
                                            console.error('❌ ExamModalsManager not found after loading');
                                        }
                                    }, 200);
                                } catch (error) {
                                    console.error('❌ Error processing exam modals JSX:', error);
                                    console.error('Error details:', error.message, error.stack);
                                    window.examModalsLoading = false;
                                    // Don't crash the page - allow it to continue without modals
                                    console.warn('⚠️ Page will continue without exam modals');
                                }
                            })
                            .catch(error => {
                                console.error('❌ Error loading exam-modals-react.jsx:', error);
                                console.warn('⚠️ Make sure the server is running on port 8000');
                                console.warn('⚠️ Error details:', error.message);
                                window.examModalsLoading = false;
                                // Don't throw - allow page to continue without modals
                            });
                    }

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', loadExamModals);
                    } else {
                        loadExamModals();
                    }
                })();
            </script>


            <!-- GenChem exam components not available - using legacy engine instead -->

            <!-- Load Biology exam -->
            <script>
                (function () {
                    // Prevent multiple loads
                    if (window.biologyExamLoading || window.biologyExamLoaded) {
                        console.log('⏭️ Biology exam already loading or loaded, skipping');
                        return;
                    }
                    window.biologyExamLoading = true;

                    let biologyRetryCount = 0;
                    const biologyMaxRetries = 50;

                    function loadBiologyExam() {
                        if (biologyRetryCount >= biologyMaxRetries) {
                            console.error('❌ Max retries reached for Biology exam');
                            window.biologyExamLoading = false;
                            return;
                        }
                        biologyRetryCount++;

                        if (typeof Babel === 'undefined' || typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                            setTimeout(loadBiologyExam, 100);
                            return;
                        }
                        biologyRetryCount = 0;

                        fetch('Biology/oat-biology-exam-react.jsx')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to load oat-biology-exam-react.jsx: ' + response.status + ' ' + response.statusText);
                                }
                                return response.text();
                            })
                            .then(jsxCode => {
                                const transformedCode = Babel.transform(jsxCode, { presets: ['react'], filename: 'oat-biology-exam-react.jsx' }).code;
                                (function () { const script = document.createElement('script'); script.textContent = transformedCode; document.body.appendChild(script); })();
                                window.biologyExamLoaded = true;
                                console.log('✅ Biology exam loaded');
                            })
                            .catch(error => { console.error('❌ Error loading Biology exam:', error); window.biologyExamLoading = false; });
                    }

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', loadBiologyExam);
                    } else {
                        loadBiologyExam();
                    }
                })();
            </script>

            <!-- Load Organic Chemistry exam -->
            <script>
                (function () {
                    // Prevent multiple loads
                    if (window.organicChemExamLoading || window.organicChemExamLoaded) {
                        console.log('⏭️ Organic Chemistry exam already loading or loaded, skipping');
                        return;
                    }
                    window.organicChemExamLoading = true;

                    let organicChemRetryCount = 0;
                    const organicChemMaxRetries = 50;

                    function loadOrganicChemExam() {
                        if (organicChemRetryCount >= organicChemMaxRetries) {
                            console.error('❌ Max retries reached for Organic Chemistry exam');
                            window.organicChemExamLoading = false;
                            return;
                        }
                        organicChemRetryCount++;

                        if (typeof Babel === 'undefined' || typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                            setTimeout(loadOrganicChemExam, 100);
                            return;
                        }
                        organicChemRetryCount = 0;

                        fetch('Organic Chemistry/oat-organic-chem-exam-react.jsx')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to load oat-organic-chem-exam-react.jsx: ' + response.status + ' ' + response.statusText);
                                }
                                return response.text();
                            })
                            .then(jsxCode => {
                                const transformedCode = Babel.transform(jsxCode, { presets: ['react'], filename: 'oat-organic-chem-exam-react.jsx' }).code;
                                (function () { const script = document.createElement('script'); script.textContent = transformedCode; document.body.appendChild(script); })();
                                window.organicChemExamLoaded = true;
                                console.log('✅ Organic Chemistry exam loaded');
                            })
                            .catch(error => { console.error('❌ Error loading Organic Chemistry exam:', error); window.organicChemExamLoading = false; });
                    }

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', loadOrganicChemExam);
                    } else {
                        loadOrganicChemExam();
                    }
                })();
            </script>

            <!-- Load Reading Comprehension exam -->
            <script>
                (function () {
                    // Prevent multiple loads
                    if (window.readingExamLoading || window.readingExamLoaded) {
                        console.log('⏭️ Reading Comprehension exam already loading or loaded, skipping');
                        return;
                    }
                    window.readingExamLoading = true;

                    let readingRetryCount = 0;
                    const readingMaxRetries = 50;

                    function loadReadingExam() {
                        if (readingRetryCount >= readingMaxRetries) {
                            console.error('❌ Max retries reached for Reading Comprehension exam');
                            window.readingExamLoading = false;
                            return;
                        }
                        readingRetryCount++;

                        if (typeof Babel === 'undefined' || typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                            setTimeout(loadReadingExam, 100);
                            return;
                        }
                        readingRetryCount = 0;

                        fetch('Reading Comprehension/oat-reading-exam-react.jsx')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to load oat-reading-exam-react.jsx: ' + response.status + ' ' + response.statusText);
                                }
                                return response.text();
                            })
                            .then(jsxCode => {
                                const transformedCode = Babel.transform(jsxCode, { presets: ['react'], filename: 'oat-reading-exam-react.jsx' }).code;
                                (function () { const script = document.createElement('script'); script.textContent = transformedCode; document.body.appendChild(script); })();
                                window.readingExamLoaded = true;
                                console.log('✅ Reading Comprehension exam loaded');
                            })
                            .catch(error => { console.error('❌ Error loading Reading Comprehension exam:', error); window.readingExamLoading = false; });
                    }

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', loadReadingExam);
                    } else {
                        loadReadingExam();
                    }
                })();
            </script>

            <!-- Load Physics exam -->
            <script>
                (function () {
                    // Prevent multiple loads
                    if (window.physicsExamLoading || window.physicsExamLoaded) {
                        console.log('⏭️ Physics exam already loading or loaded, skipping');
                        return;
                    }
                    window.physicsExamLoading = true;

                    let physicsRetryCount = 0;
                    const physicsMaxRetries = 50;

                    function loadPhysicsExam() {
                        if (physicsRetryCount >= physicsMaxRetries) {
                            console.error('❌ Max retries reached for Physics exam');
                            window.physicsExamLoading = false;
                            return;
                        }
                        physicsRetryCount++;

                        if (typeof Babel === 'undefined' || typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                            setTimeout(loadPhysicsExam, 100);
                            return;
                        }
                        physicsRetryCount = 0;

                        fetch('Physics/oat-physics-exam-react.jsx')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to load oat-physics-exam-react.jsx: ' + response.status + ' ' + response.statusText);
                                }
                                return response.text();
                            })
                            .then(jsxCode => {
                                const transformedCode = Babel.transform(jsxCode, { presets: ['react'], filename: 'oat-physics-exam-react.jsx' }).code;
                                (function () { const script = document.createElement('script'); script.textContent = transformedCode; document.body.appendChild(script); })();
                                window.physicsExamLoaded = true;
                                console.log('✅ Physics exam loaded');
                            })
                            .catch(error => { console.error('❌ Error loading Physics exam:', error); window.physicsExamLoading = false; });
                    }

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', loadPhysicsExam);
                    } else {
                        loadPhysicsExam();
                    }
                })();
            </script>

            <!-- Load General Chemistry Test 1 -->
            <script>
                (function () {
                    // Prevent multiple loads
                    if (window.genChemTest1Loading || window.genChemTest1Loaded) {
                        console.log('⏭️ General Chemistry Test 1 already loading or loaded, skipping');
                        return;
                    }
                    window.genChemTest1Loading = true;

                    let genChemTest1RetryCount = 0;
                    const genChemTest1MaxRetries = 50;

                    function loadGenChemTest1() {
                        if (genChemTest1RetryCount >= genChemTest1MaxRetries) {
                            console.error('❌ Max retries reached for General Chemistry Test 1');
                            window.genChemTest1Loading = false;
                            return;
                        }
                        genChemTest1RetryCount++;

                        if (typeof Babel === 'undefined' || typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                            setTimeout(loadGenChemTest1, 100);
                            return;
                        }
                        genChemTest1RetryCount = 0;

                        fetch('General Chemistry/oat-genchem-test1-react.jsx')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to load oat-genchem-test1-react.jsx: ' + response.status + ' ' + response.statusText);
                                }
                                return response.text();
                            })
                            .then(jsxCode => {
                                const transformedCode = Babel.transform(jsxCode, { presets: ['react'], filename: 'oat-genchem-test1-react.jsx' }).code;
                                (function () { const script = document.createElement('script'); script.textContent = transformedCode; document.body.appendChild(script); })();
                                window.genChemTest1Loaded = true;
                                console.log('✅ General Chemistry Test 1 loaded');
                            })
                            .catch(error => { console.error('❌ Error loading General Chemistry Test 1:', error); window.genChemTest1Loading = false; });
                    }

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', loadGenChemTest1);
                    } else {
                        loadGenChemTest1();
                    }
                })();
            </script>

            <!-- Load General Chemistry Test 2 -->
            <script>
                (function () {
                    // Prevent multiple loads
                    if (window.genChemTest2Loading || window.genChemTest2Loaded) {
                        console.log('⏭️ General Chemistry Test 2 already loading or loaded, skipping');
                        return;
                    }
                    window.genChemTest2Loading = true;

                    let genChemTest2RetryCount = 0;
                    const genChemTest2MaxRetries = 50;

                    function loadGenChemTest2() {
                        if (genChemTest2RetryCount >= genChemTest2MaxRetries) {
                            console.error('❌ Max retries reached for General Chemistry Test 2');
                            window.genChemTest2Loading = false;
                            return;
                        }
                        genChemTest2RetryCount++;

                        if (typeof Babel === 'undefined' || typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                            setTimeout(loadGenChemTest2, 100);
                            return;
                        }
                        genChemTest2RetryCount = 0;

                        fetch('General Chemistry/oat-genchem-test2-react.jsx')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to load oat-genchem-test2-react.jsx: ' + response.status + ' ' + response.statusText);
                                }
                                return response.text();
                            })
                            .then(jsxCode => {
                                const transformedCode = Babel.transform(jsxCode, { presets: ['react'], filename: 'oat-genchem-test2-react.jsx' }).code;
                                (function () { const script = document.createElement('script'); script.textContent = transformedCode; document.body.appendChild(script); })();
                                window.genChemTest2Loaded = true;
                                console.log('✅ General Chemistry Test 2 loaded');
                            })
                            .catch(error => { console.error('❌ Error loading General Chemistry Test 2:', error); window.genChemTest2Loading = false; });
                    }

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', loadGenChemTest2);
                    } else {
                        loadGenChemTest2();
                    }
                })();
            </script>

            <!-- Load Quantitative Reasoning exam -->
            <script>
                (function () {
                    // Prevent multiple loads
                    if (window.quantitativeExamLoading || window.quantitativeExamLoaded) {
                        console.log('⏭️ Quantitative Reasoning exam already loading or loaded, skipping');
                        return;
                    }
                    window.quantitativeExamLoading = true;

                    let quantitativeRetryCount = 0;
                    const quantitativeMaxRetries = 50;

                    function loadQuantitativeExam() {
                        if (quantitativeRetryCount >= quantitativeMaxRetries) {
                            console.error('❌ Max retries reached for Quantitative Reasoning exam');
                            window.quantitativeExamLoading = false;
                            return;
                        }
                        quantitativeRetryCount++;

                        if (typeof Babel === 'undefined' || typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                            setTimeout(loadQuantitativeExam, 100);
                            return;
                        }
                        quantitativeRetryCount = 0;

                        fetch('Quantitative Reasoning/oat-quantitative-exam-react.jsx')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to load oat-quantitative-exam-react.jsx: ' + response.status + ' ' + response.statusText);
                                }
                                return response.text();
                            })
                            .then(jsxCode => {
                                const transformedCode = Babel.transform(jsxCode, { presets: ['react'], filename: 'oat-quantitative-exam-react.jsx' }).code;
                                (function () { const script = document.createElement('script'); script.textContent = transformedCode; document.body.appendChild(script); })();
                                window.quantitativeExamLoaded = true;
                                console.log('✅ Quantitative Reasoning exam loaded');
                            })
                            .catch(error => { console.error('❌ Error loading Quantitative Reasoning exam:', error); window.quantitativeExamLoading = false; });
                    }

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', loadQuantitativeExam);
                    } else {
                        loadQuantitativeExam();
                    }
                })();
            </script>

            <!-- Organic Chemistry PT1 Author Access Button (Floating) -->
            <button id="organic-chem-author-btn" onclick="window.showOrganicChemPT1AuthorView()"
                style="position: fixed; bottom: 20px; right: 20px; z-index: 100; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50%; width: 60px; height: 60px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); cursor: pointer; font-size: 24px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: transform 0.2s, box-shadow 0.2s;"
                onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.4)';"
                onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.3)';"
                title="Organic Chemistry PT1 Image Authoring">
                🧪
            </button>

            <!-- OChem PT1 Reset Button (for debugging) -->
            <button id="ochem-reset-btn"
                onclick="if(confirm('Reset OChem PT1 to placeholder questions?')) { window.resetOChemPT1Data(); alert('Reset complete! Refresh the page.'); }"
                style="position: fixed; bottom: 90px; right: 20px; z-index: 100; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; border-radius: 6px; padding: 8px 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); cursor: pointer; font-size: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: transform 0.2s, box-shadow 0.2s;"
                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.4)';"
                onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.3)';"
                title="Reset OChem PT1 Data">
                🔄 Reset
            </button>

            <!-- Exam Button Settings Modal -->
            <div id="exam-button-settings-modal"
                style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
                <div
                    style="max-width: 800px; margin: 50px auto; background: white; border-radius: 12px; padding: 32px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; border-bottom: 2px solid #e5e7eb; padding-bottom: 16px;">
                        <h2 style="font-size: 24px; font-weight: 700; color: #111827; margin: 0;">Exam Button Settings
                        </h2>
                        <button onclick="closeExamButtonSettings()"
                            style="background: #f3f4f6; border: none; border-radius: 8px; width: 32px; height: 32px; cursor: pointer; font-size: 20px; color: #6b7280; display: flex; align-items: center; justify-content: center;">×</button>
                    </div>
                    <p style="color: #6b7280; margin-bottom: 24px;">Upload custom images for exam buttons. Images will
                        replace text labels. Recommended size: 28-32px height.</p>
                    <div id="exam-button-settings-content" style="display: grid; gap: 24px;">
                        <!-- Buttons will be dynamically generated here -->
                    </div>
                    <div
                        style="margin-top: 32px; display: flex; gap: 12px; justify-content: flex-end; border-top: 2px solid #e5e7eb; padding-top: 24px;">
                        <button onclick="closeExamButtonSettings()"
                            style="padding: 10px 24px; background: #f3f4f6; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; color: #374151;">Cancel</button>
                        <button onclick="saveExamButtonSettings()"
                            style="padding: 10px 24px; background: #3b82f6; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; color: white;">Save
                            Settings</button>
                    </div>
                </div>
            </div>

</body>

</html>